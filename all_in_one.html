<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academic Authenticity Validator - All in One</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            color: white;
            text-decoration: none;
            font-weight: 700;
            font-size: 1.5rem;
        }

        .logo i {
            margin-right: 0.5rem;
            color: #00ff88;
        }

        .digilocker-badge {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-left: 1rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .auth-status {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 25px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logout-btn {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid rgba(244, 67, 54, 0.5);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: rgba(244, 67, 54, 0.4);
        }

        .main-container {
            margin-top: 80px;
            padding: 2rem;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .tab-navigation {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 0.5rem;
        }

        .tab-button {
            padding: 1rem 2rem;
            background: transparent;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            margin: 0 0.25rem;
        }

        .tab-button.active {
            background: rgba(0, 255, 136, 0.3);
            color: #00ff88;
        }

        .tab-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .tab-content {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            color: #333;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }

        .section-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-align: center;
            color: #333;
        }

        .section-subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }

        .form-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            color: white;
        }

        .result-container {
            margin-top: 2rem;
            padding: 2rem;
            background: #f8f9fa;
            border-radius: 15px;
            display: none;
        }

        .result-success {
            border-left: 5px solid #28a745;
            background: #d4edda;
        }

        .result-error {
            border-left: 5px solid #dc3545;
            background: #f8d7da;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .stat-growth {
            font-size: 0.9rem;
            margin-top: 0.5rem;
            opacity: 0.9;
            font-weight: bold;
        }

        .analytics-chart {
            width: 100%;
            height: 200px;
        }

        .institution-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem;
            margin: 0.5rem 0;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .degree-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }

        .degree-bar {
            background: linear-gradient(90deg, #667eea, #764ba2);
            height: 6px;
            border-radius: 3px;
            margin-top: 0.3rem;
        }

        .performance-metric {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }

        .metric-value {
            font-weight: bold;
            color: #667eea;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .upload-area {
            border: 2px dashed #ccc;
            border-radius: 15px;
            padding: 3rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .upload-area.dragover {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            background: #00ff88;
            color: white;
            padding: 1rem 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 2000;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        @media (max-width: 768px) {
            .tab-navigation {
                flex-wrap: wrap;
            }
            .tab-button {
                flex: 1;
                min-width: 120px;
            }
            .main-container {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="nav-container">
            <a href="#" class="logo">
                <i class="fas fa-shield-check"></i>
                Academic Authenticity Validator
                <div class="digilocker-badge">
                    <i class="fas fa-cloud"></i>
                    Powered by DigiLocker
                </div>
            </a>
            <div class="auth-status" id="authStatus">
                <!-- Authentication status will be populated by JavaScript -->
            </div>
        </nav>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-button active" onclick="showTab('verify')">
                <i class="fas fa-search"></i> Verify Certificate
            </button>
            <button class="tab-button" onclick="showTab('issue')">
                <i class="fas fa-certificate"></i> Issue Credential
            </button>
            <button class="tab-button" onclick="showTab('upload')">
                <i class="fas fa-upload"></i> Upload Certificate
            </button>
            <button class="tab-button" onclick="showTab('dashboard')">
                <i class="fas fa-chart-bar"></i> Dashboard
            </button>
            <button class="tab-button" onclick="showTab('blockchain')">
                <i class="fas fa-link"></i> Blockchain Explorer
            </button>
            <button class="tab-button" onclick="showTab('advanced')">
                <i class="fas fa-robot"></i> Advanced Features
            </button>
            <button class="tab-button" onclick="showTab('digilocker')">
                <i class="fas fa-cloud"></i> DigiLocker/NAD
            </button>
        </div>

        <!-- Verify Certificate Tab -->
        <div id="verify" class="tab-content active">
            <h2 class="section-title">‚úì Verify Academic Certificate</h2>
            <p class="section-subtitle">Enter the verification code to authenticate academic credentials</p>
            
            <div class="form-group">
                <label class="form-label">Verification Code</label>
                <input type="text" id="verificationCode" class="form-input" 
                       placeholder="Enter 12-character verification code" 
                       style="text-align: center; letter-spacing: 2px; text-transform: uppercase;">
            </div>
            
            <div style="text-align: center;">
                <button class="btn btn-primary" onclick="verifyNow()">
                    <i class="fas fa-search"></i> ‚úì Verify Certificate
                </button>
            </div>

            <div id="verifyResult" class="result-container"></div>
        </div>

        <!-- Issue Credential Tab -->
        <div id="issue" class="tab-content">
            <h2 class="section-title">Generate Certificate</h2>
            <p class="section-subtitle">Select certificate type and generate professional certificates</p>
            
            <!-- Certificate Type Selector -->
            <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 10px; margin-bottom: 2rem;">
                <label class="form-label" style="font-size: 1.1rem; margin-bottom: 1rem; display: block;">
                    <i class="fas fa-certificate"></i> Select Certificate Type:
                </label>
                <select id="certificateType" class="form-input" onchange="showCertificateForm(this.value)" style="font-size: 1rem;">
                    <option value="">-- Choose Certificate Type --</option>
                    <optgroup label="Academic Certificates">
                        <option value="sslc">SSLC Certificate (10th Standard)</option>
                        <option value="hsc1">HSC First Year (11th Standard)</option>
                        <option value="hsc2">HSC Second Year (12th Standard)</option>
                        <option value="degree">Degree Certificate (College)</option>
                    </optgroup>
                    <optgroup label="Government Certificates">
                        <option value="income">Income Certificate</option>
                        <option value="community">Community Certificate</option>
                        <option value="nativity">Nativity Certificate</option>
                        <option value="transfer">Transfer Certificate</option>
                        <option value="firstgraduate">First Graduate Certificate</option>
                    </optgroup>
                </select>
            </div>

            <!-- Certificate Forms Container -->
            <div id="certificateForms">
                <div style="text-align: center; padding: 3rem; color: #666;">
                    <i class="fas fa-arrow-up" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
                    <p style="font-size: 1.1rem;">Please select a certificate type from the dropdown above</p>
                </div>
            </div>

            <div id="issueResult" class="result-container"></div>
        </div>

        <!-- Upload Certificate Tab -->
        <div id="upload" class="tab-content">
            <h2 class="section-title">Upload Certificate</h2>
            <p class="section-subtitle">Upload existing certificates for verification and blockchain storage</p>
            
            <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;"></i>
                <h3>Drop files here or click to upload</h3>
                <p>Supported formats: PDF, PNG, JPG (Max 10MB)</p>
                <input type="file" id="fileInput" style="display: none;" accept=".pdf,.png,.jpg,.jpeg" onchange="handleFileSelect(this)">
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 2rem;">
                <div class="form-group">
                    <label class="form-label">Student Name</label>
                    <input type="text" id="uploadStudentName" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Student ID</label>
                    <input type="text" id="uploadStudentId" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Institution Name</label>
                    <input type="text" id="uploadInstitutionName" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Degree Type</label>
                    <input type="text" id="uploadDegreeType" class="form-input">
                </div>
            </div>

            <div style="text-align: center; margin-top: 2rem;">
                <button class="btn btn-primary" onclick="uploadCertificate()">
                    <i class="fas fa-upload"></i> Upload Certificate
                </button>
            </div>

            <div id="uploadResult" class="result-container"></div>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content">
            <h2 class="section-title">üìä Advanced Analytics Dashboard</h2>
            <p class="section-subtitle">Real-time statistics, trends, and insights</p>
            
            <!-- Overview Stats -->
            <div class="stats-grid" style="margin-bottom: 2rem;">
                <div class="stat-card" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                    <div class="stat-number" id="totalCertificates">0</div>
                    <div class="stat-label">üìú Total Certificates</div>
                    <div class="stat-growth" id="certificateGrowth">+0%</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #28a745, #20c997);">
                    <div class="stat-number" id="verifiedCertificates">0</div>
                    <div class="stat-label">‚úÖ Verifications Today</div>
                    <div class="stat-growth" id="verificationGrowth">+0%</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #ffc107, #fd7e14);">
                    <div class="stat-number" id="totalInstitutions">0</div>
                    <div class="stat-label">üèõÔ∏è Active Institutions</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #dc3545, #e83e8c);">
                    <div class="stat-number" id="blockchainTransactions">0</div>
                    <div class="stat-label">üîó Blockchain Txns</div>
                </div>
            </div>
            
            <!-- Analytics Charts Section -->
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                <!-- Weekly Trends Chart -->
                <div style="background: white; padding: 1.5rem; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    <h3 style="margin-bottom: 1rem; color: #333;">üìà Weekly Activity Trends</h3>
                    <canvas id="weeklyTrendsChart" width="400" height="200"></canvas>
                </div>
                
                <!-- Top Institutions -->
                <div style="background: white; padding: 1.5rem; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    <h3 style="margin-bottom: 1rem; color: #333;">üèÜ Top Institutions</h3>
                    <div id="topInstitutions">
                        <p style="color: #666;">Loading top institutions...</p>
                    </div>
                </div>
            </div>
            
            <!-- Degree Trends and Performance -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                <!-- Degree Type Distribution -->
                <div style="background: white; padding: 1.5rem; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    <h3 style="margin-bottom: 1rem; color: #333;">üéì Popular Degree Types</h3>
                    <div id="degreeDistribution">
                        <p style="color: #666;">Loading degree trends...</p>
                    </div>
                </div>
                
                <!-- API Performance -->
                <div style="background: white; padding: 1.5rem; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    <h3 style="margin-bottom: 1rem; color: #333;">‚ö° API Performance</h3>
                    <div id="apiPerformance">
                        <p style="color: #666;">Loading performance metrics...</p>
                    </div>
                </div>
            </div>

            <div style="background: #f8f9fa; padding: 2rem; border-radius: 15px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3 style="color: #333; margin: 0;">Recent Activity</h3>
                    <button class="btn btn-primary" onclick="refreshDashboard()" style="padding: 0.5rem 1rem;">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
                <div id="recentActivity">
                    <p style="color: #666;">Loading recent activities...</p>
                </div>
            </div>
        </div>

        <!-- Blockchain Explorer Tab -->
        <div id="blockchain" class="tab-content">
            <h2 class="section-title">üîó Blockchain Explorer</h2>
            <p class="section-subtitle">Real-time blockchain monitoring and transaction explorer</p>
            
            <!-- Blockchain Stats -->
            <div class="stats-grid" style="margin-bottom: 2rem;">
                <div class="stat-card" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                    <div class="stat-number" id="totalBlocks">0</div>
                    <div class="stat-label">üîó Total Blocks</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #00ff88, #00cc6a);">
                    <div class="stat-number" id="totalTransactions">0</div>
                    <div class="stat-label">üìù Transactions</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #ff6b6b, #ee5a24);">
                    <div class="stat-number" id="chainDifficulty">0</div>
                    <div class="stat-label">‚õèÔ∏è Mining Difficulty</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #feca57, #ff9ff3);">
                    <div class="stat-number" id="chainValid">‚úì</div>
                    <div class="stat-label">üõ°Ô∏è Chain Status</div>
                </div>
            </div>

            <!-- Mining Section -->
            <div style="background: #e8f5e8; padding: 1.5rem; border-radius: 15px; margin-bottom: 2rem;">
                <h3 style="color: #333; margin-bottom: 1rem;">‚õèÔ∏è Blockchain Mining</h3>
                <p style="color: #666; margin-bottom: 1rem;">Mine pending transactions to add them to the blockchain</p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                    <div>
                        <button class="btn btn-success" onclick="mineNewBlock()">
                            <i class="fas fa-hammer"></i> Mine Block
                        </button>
                    </div>
                    <div>
                        <button class="btn btn-info" onclick="addCustomTransaction()">
                            <i class="fas fa-plus"></i> Add Transaction
                        </button>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                    <div>
                        <button class="btn btn-secondary" onclick="viewPendingTransactions()">
                            <i class="fas fa-clock"></i> View Pending (<span id="pendingCount">0</span>)
                        </button>
                    </div>
                    <div>
                        <button class="btn btn-warning" onclick="refreshBlockchain()">
                            <i class="fas fa-sync"></i> Refresh Chain
                        </button>
                    </div>
                </div>
                
                <div id="miningResult" style="margin-top: 1rem;"></div>
            </div>

            <!-- Recent Blocks -->
            <div style="background: #f8f9fa; padding: 2rem; border-radius: 15px;">
                <h3 style="margin-bottom: 1rem; color: #333;">üì¶ Recent Blocks</h3>
                <div id="blockchainBlocks">
                    <p style="color: #666;">Loading blockchain data...</p>
                </div>
            </div>
        </div>

        <!-- Advanced Features Tab -->
        <div id="advanced" class="tab-content">
            <h2 class="section-title">ü§ñ Advanced Features</h2>
            <p class="section-subtitle">AI-powered certificate analysis and advanced verification tools</p>
            
            <!-- Feature Overview -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                <div class="feature-card">
                    <div class="feature-icon">üîç</div>
                    <h3>OCR & Forensics</h3>
                    <p>Advanced image analysis using Tesseract OCR and computer vision for forgery detection</p>
                    <div class="feature-status" id="ocrStatus">Loading...</div>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">üîê</div>
                    <h3>PKI Digital Signing</h3>
                    <p>Government-compliant digital signatures with Indian e-sign/CCA integration</p>
                    <div class="feature-status" id="pkiStatus">Loading...</div>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">‚öñÔ∏è</div>
                    <h3>Dual Strategy</h3>
                    <p>Smart processing for both legacy physical certificates and modern blockchain certificates</p>
                    <div class="feature-status" id="dualStatus">Loading...</div>
                </div>
                
                <div class="feature-card">
                    <div class="feature-icon">ü§ñ</div>
                    <h3>ML Forensics</h3>
                    <p>Machine learning models for advanced forgery detection and database matching</p>
                    <div class="feature-status" id="mlStatus">Loading...</div>
                </div>
            </div>

            <!-- Advanced Verification Section -->
            <div style="background: #f8f9fa; padding: 2rem; border-radius: 15px; margin-bottom: 2rem;">
                <h3 style="color: #333; margin-bottom: 1rem;">üî¨ Advanced Certificate Analysis</h3>
                <p style="color: #666; margin-bottom: 1.5rem;">Upload a certificate image for comprehensive AI-powered analysis</p>
                
                <div class="form-group">
                    <label class="form-label" style="color: #333;">Certificate Image</label>
                    <input type="file" id="advancedImageUpload" class="form-input" accept="image/*" onchange="previewAdvancedImage()">
                </div>
                
                <div id="advancedImagePreview" style="margin: 1rem 0; display: none;">
                    <img id="previewImg" style="max-width: 300px; max-height: 200px; border-radius: 10px; border: 2px solid #ddd;">
                </div>
                
                <button class="btn btn-primary" onclick="performAdvancedAnalysis()" id="analyzeBtn" disabled>
                    <i class="fas fa-microscope"></i> Analyze Certificate
                </button>
                
                <div id="advancedAnalysisResult" style="margin-top: 1.5rem;"></div>
            </div>

            <!-- System Status Section -->
            <div style="background: #e8f5e8; padding: 2rem; border-radius: 15px; margin-bottom: 2rem;">
                <h3 style="color: #333; margin-bottom: 1rem;">üìä Advanced System Status</h3>
                <div id="advancedSystemStatus">
                    <p style="color: #666;">Loading system status...</p>
                </div>
                <button class="btn btn-success" onclick="refreshAdvancedStatus()">
                    <i class="fas fa-sync"></i> Refresh Status
                </button>
            </div>

            <!-- ML Training Section -->
            <div style="background: #fff3cd; padding: 2rem; border-radius: 15px;">
                <h3 style="color: #333; margin-bottom: 1rem;">üß† Machine Learning Training</h3>
                <p style="color: #666; margin-bottom: 1rem;">Train ML models with new certificate data for improved accuracy</p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                    <div>
                        <label style="color: #333; font-weight: 500;">Training Data Size:</label>
                        <div id="trainingDataSize" style="font-size: 1.2rem; font-weight: 600; color: #007bff;">Loading...</div>
                    </div>
                    <div>
                        <label style="color: #333; font-weight: 500;">Model Accuracy:</label>
                        <div id="modelAccuracy" style="font-size: 1.2rem; font-weight: 600; color: #28a745;">Loading...</div>
                    </div>
                </div>
                
                <button class="btn btn-warning" onclick="simulateMLTraining()">
                    <i class="fas fa-brain"></i> Simulate ML Training
                </button>
                <div id="mlTrainingResult" style="margin-top: 1rem;"></div>
            </div>
        </div>

        <!-- DigiLocker/NAD Integration Tab -->
        <div id="digilocker" class="tab-content">
            <h2 class="section-title">üì± DigiLocker & NAD Integration</h2>
            <p class="section-subtitle">Access and verify your authentic academic documents from DigiLocker and National Academic Depository</p>
            
            <!-- Authentication Status -->
            <div id="digilockerAuthStatus" style="background: #f8f9fa; padding: 2rem; border-radius: 15px; margin-bottom: 2rem;">
                <h3 style="color: #333; margin-bottom: 1rem;">üîê Authentication Status</h3>
                <div id="authStatusContent">
                    <p style="color: #666;">Loading authentication status...</p>
                </div>
            </div>

            <!-- DigiLocker Documents -->
            <div style="background: #e8f4fd; padding: 2rem; border-radius: 15px; margin-bottom: 2rem;">
                <h3 style="color: #333; margin-bottom: 1rem;">üìÑ Your DigiLocker Documents</h3>
                <p style="color: #666; margin-bottom: 1.5rem;">Access your verified academic documents stored in DigiLocker</p>
                
                <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                    <button class="btn btn-primary" onclick="loadDigiLockerDocuments()">
                        <i class="fas fa-cloud-download-alt"></i> Load Documents
                    </button>
                    <button class="btn btn-secondary" onclick="refreshDocuments()">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                </div>
                
                <div id="digilockerDocuments">
                    <p style="color: #666;">Click "Load Documents" to fetch your DigiLocker documents</p>
                </div>
            </div>

            <!-- Document Verification -->
            <div style="background: #f0f8f0; padding: 2rem; border-radius: 15px; margin-bottom: 2rem;">
                <h3 style="color: #333; margin-bottom: 1rem;">‚úÖ DigiLocker + NAD Verification</h3>
                <p style="color: #666; margin-bottom: 1.5rem;">Verify documents using both DigiLocker and National Academic Depository</p>
                
                <div class="form-group">
                    <label class="form-label" style="color: #333;">Document URI or ID</label>
                    <input type="text" id="documentURI" class="form-input" 
                           placeholder="Enter DigiLocker document URI (e.g., in.gov.cbse-HSCER-201412345678)">
                </div>
                
                <button class="btn btn-success" onclick="verifyWithDigiLocker()">
                    <i class="fas fa-shield-check"></i> Verify with DigiLocker & NAD
                </button>
                
                <div id="digilockerVerificationResult" style="margin-top: 1.5rem;"></div>
            </div>

            <!-- NAD Statistics -->
            <div style="background: #fff8e1; padding: 2rem; border-radius: 15px; margin-bottom: 2rem;">
                <h3 style="color: #333; margin-bottom: 1rem;">üìä NAD Integration Statistics</h3>
                <div id="nadStatistics">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div style="text-align: center; padding: 1rem; background: white; border-radius: 10px;">
                            <div style="font-size: 2rem; color: #ff6b6b; margin-bottom: 0.5rem;">
                                <i class="fas fa-university"></i>
                            </div>
                            <div style="font-size: 1.5rem; font-weight: 600; color: #333;" id="verifiedInstitutions">0</div>
                            <div style="color: #666; font-size: 0.9rem;">Verified Institutions</div>
                        </div>
                        
                        <div style="text-align: center; padding: 1rem; background: white; border-radius: 10px;">
                            <div style="font-size: 2rem; color: #4ecdc4; margin-bottom: 0.5rem;">
                                <i class="fas fa-certificate"></i>
                            </div>
                            <div style="font-size: 1.5rem; font-weight: 600; color: #333;" id="verifiedDocuments">0</div>
                            <div style="color: #666; font-size: 0.9rem;">Verified Documents</div>
                        </div>
                        
                        <div style="text-align: center; padding: 1rem; background: white; border-radius: 10px;">
                            <div style="font-size: 2rem; color: #95e1d3; margin-bottom: 0.5rem;">
                                <i class="fas fa-users"></i>
                            </div>
                            <div style="font-size: 1.5rem; font-weight: 600; color: #333;" id="activeUsers">0</div>
                            <div style="color: #666; font-size: 0.9rem;">Active Users</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div style="background: #f5f5f5; padding: 2rem; border-radius: 15px;">
                <h3 style="color: #333; margin-bottom: 1rem;">‚ö° Quick Actions</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                    <button class="btn btn-info" onclick="pullFromNAD()">
                        <i class="fas fa-download"></i> Pull from NAD
                    </button>
                    <button class="btn btn-warning" onclick="syncWithDigiLocker()">
                        <i class="fas fa-sync-alt"></i> Sync with DigiLocker
                    </button>
                    <button class="btn btn-primary" onclick="exportVerificationReport()">
                        <i class="fas fa-file-export"></i> Export Report
                    </button>
                    <button class="btn btn-secondary" onclick="viewIntegrationLogs()">
                        <i class="fas fa-list"></i> View Logs
                    </button>
                </div>
                
                <div id="quickActionResult" style="margin-top: 1.5rem;"></div>
            </div>
        </div>
    </div>

    <style>
        .feature-card {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
        }
        
        .feature-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        
        .feature-card h3 {
            color: #333;
            margin-bottom: 0.5rem;
            font-size: 1.2rem;
        }
        
        .feature-card p {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        
        .feature-status {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-operational {
            background: #d4edda;
            color: #155724;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>

    <script>
        // Tab Management
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
            
            // Load data for specific tabs
            if (tabName === 'dashboard') {
                loadDashboardData();
            } else if (tabName === 'blockchain') {
                loadBlockchainExplorer();
            } else if (tabName === 'advanced') {
                loadAdvancedFeatures();
            }
        }

        // Verify Certificate
        async function verifyNow() {
            const code = document.getElementById('verificationCode').value.trim();
            const resultDiv = document.getElementById('verifyResult');
            
            if (!code) {
                showResult(resultDiv, 'Please enter a verification code', 'error');
                return;
            }

            try {
                const response = await fetch('/api/verify-certificate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ verification_code: code })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                let result;
                try {
                    result = await response.json();
                } catch (jsonError) {
                    throw new Error(`JSON parsing failed: ${jsonError.message}`);
                }
                
                if (result.valid && result.certificate) {
                    const cert = result.certificate;
                    const blockchainStatus = result.blockchain_verified ? 
                        '<span style="color: #00ff88;"><i class="fas fa-link"></i> ‚úì BLOCKCHAIN VERIFIED</span>' : 
                        '<span style="color: #ffc107;"><i class="fas fa-exclamation-triangle"></i> Database Only</span>';
                    
                    const securityLevel = result.security_status === 'SECURE' ? 
                        '<span style="color: #28a745;">üîí SECURE</span>' : 
                        '<span style="color: #ffc107;">‚ö†Ô∏è LIMITED</span>';
                    
                    const html = `
                        <h3 style="color: #28a745; margin-bottom: 1rem;">
                            <i class="fas fa-check-circle"></i> ‚úì Certificate Verified
                        </h3>
                        <div style="background: #e8f5e8; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <p><strong>Verification Level:</strong> ${result.verification_level}</p>
                            <p><strong>Blockchain Status:</strong> ${blockchainStatus}</p>
                            <p><strong>Security Level:</strong> ${securityLevel}</p>
                            ${result.blockchain_details && result.blockchain_details.blockchain_hash ? 
                                `<p><strong>Blockchain Hash:</strong> <code style="font-size: 0.8em;">${result.blockchain_details.blockchain_hash.substring(0, 32)}...</code></p>` : ''}
                            ${result.blockchain_details && result.blockchain_details.block_index ? 
                                `<p><strong>Block Index:</strong> #${result.blockchain_details.block_index}</p>` : ''}
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <p><strong>Student:</strong> ${cert.student_name}</p>
                            <p><strong>ID:</strong> ${cert.student_id}</p>
                            <p><strong>Institution:</strong> ${cert.institution_name}</p>
                            <p><strong>Degree:</strong> ${cert.degree_type}</p>
                            <p><strong>Field:</strong> ${cert.field_of_study}</p>
                            <p><strong>Status:</strong> <span style="color: #28a745;">‚úì ${cert.verification_status.toUpperCase()}</span></p>
                            <p><strong>Issue Date:</strong> ${cert.issue_date}</p>
                            <p><strong>Graduation:</strong> ${cert.graduation_date}</p>
                        </div>
                        <div style="margin-top: 2rem; text-align: center;">
                            <button class="btn btn-primary" onclick="generateCertificate('${code}')" style="margin-right: 1rem;">
                                <i class="fas fa-qrcode"></i> Generate QR Certificate
                            </button>
                            <button class="btn btn-success" onclick="downloadCertificate('${code}')" style="margin-right: 1rem;">
                                <i class="fas fa-download"></i> Download PDF
                            </button>
                            <button class="btn btn-info" onclick="viewCertificate('${code}')">
                                <i class="fas fa-eye"></i> View Certificate
                            </button>
                            <button class="btn btn-warning" onclick="emailCertificate('${code}')" style="margin-top: 0.5rem;">
                                <i class="fas fa-envelope"></i> üìß Email Certificate
                            </button>
                        </div>
                    `;
                    showResult(resultDiv, html, 'success');
                    showNotification('‚úì Certificate verified with blockchain technology!');
                } else {
                    showResult(resultDiv, `Certificate not found or invalid verification code. ${result.error || ''}`, 'error');
                }
            } catch (error) {
                showResult(resultDiv, 'Error verifying certificate: ' + error.message, 'error');
            }
        }

        // Issue Credential
        async function issueCredential() {
            const data = {
                studentName: document.getElementById('studentName').value,
                studentId: document.getElementById('studentId').value,
                institutionName: document.getElementById('institutionName').value,
                institutionId: document.getElementById('institutionId').value,
                degreeType: document.getElementById('degreeType').value,
                fieldOfStudy: document.getElementById('fieldOfStudy').value,
                graduationDate: document.getElementById('graduationDate').value,
                grade: document.getElementById('grade').value
            };

            const resultDiv = document.getElementById('issueResult');

            // Validate required fields
            if (!data.studentName || !data.studentId || !data.institutionName || !data.degreeType) {
                showResult(resultDiv, 'Please fill in all required fields', 'error');
                return;
            }

            try {
                const response = await fetch('/api/issue-credential', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                let result;
                try {
                    result = await response.json();
                } catch (jsonError) {
                    throw new Error(`JSON parsing failed: ${jsonError.message}`);
                }
                
                if (result.success) {
                    const blockchainStatus = result.blockchain_verified ? 
                        '<span style="color: #00ff88;"><i class="fas fa-link"></i> ‚úì RECORDED ON BLOCKCHAIN</span>' : 
                        '<span style="color: #ffc107;"><i class="fas fa-exclamation-triangle"></i> Database Only</span>';
                    
                    const html = `
                        <h3 style="color: #28a745; margin-bottom: 1rem;">
                            <i class="fas fa-check-circle"></i> ‚úì Credential Issued Successfully
                        </h3>
                        <div style="background: #e8f5e8; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <p><strong>Blockchain Status:</strong> ${blockchainStatus}</p>
                            ${result.blockchain_hash ? 
                                `<p><strong>Blockchain Hash:</strong> <code style="font-size: 0.8em;">${result.blockchain_hash.substring(0, 32)}...</code></p>` : ''}
                            ${result.block_index ? 
                                `<p><strong>Block Index:</strong> #${result.block_index}</p>` : ''}
                            <p><strong>Transaction ID:</strong> ${result.transaction_id || 'N/A'}</p>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <p><strong>Credential ID:</strong> ${result.credential_id}</p>
                            <p><strong>Student:</strong> ${data.studentName}</p>
                            <p><strong>Institution:</strong> ${data.institutionName}</p>
                            <p><strong>Degree:</strong> ${data.degreeType}</p>
                        </div>
                        <div style="background: #fff3cd; padding: 1rem; border-radius: 8px; margin-top: 1rem;">
                            <p><strong>üîë Verification Code:</strong></p>
                            <code style="background: #f8f9fa; padding: 0.5rem; border-radius: 5px; font-size: 1.2em; display: block; text-align: center; margin-top: 0.5rem;">${result.verification_code}</code>
                            <p style="font-size: 0.9em; color: #856404; margin-top: 0.5rem;">Save this code for certificate verification</p>
                        </div>
                    `;
                    showResult(resultDiv, html, 'success');
                    showNotification('‚úì Credential issued and recorded on blockchain!');
                    
                    // Clear form
                    document.querySelectorAll('#issue input, #issue select').forEach(input => input.value = '');
                } else {
                    showResult(resultDiv, result.error || 'Failed to issue credential', 'error');
                }
            } catch (error) {
                showResult(resultDiv, 'Error issuing credential: ' + error.message, 'error');
            }
        }

        // Upload Certificate
        function handleFileSelect(input) {
            const file = input.files[0];
            if (file) {
                document.querySelector('.upload-area h3').textContent = `Selected: ${file.name}`;
            }
        }

        async function uploadCertificate() {
            const fileInput = document.getElementById('fileInput');
            const resultDiv = document.getElementById('uploadResult');
            
            if (!fileInput.files[0]) {
                showResult(resultDiv, 'Please select a file to upload', 'error');
                return;
            }

            const formData = new FormData();
            formData.append('certificate_file', fileInput.files[0]);
            formData.append('studentName', document.getElementById('uploadStudentName').value);
            formData.append('studentId', document.getElementById('uploadStudentId').value);
            formData.append('institutionName', document.getElementById('uploadInstitutionName').value);
            formData.append('degreeType', document.getElementById('uploadDegreeType').value);

            try {
                const response = await fetch('/api/upload-certificate', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                
                if (result.success) {
                    const html = `
                        <h3 style="color: #28a745; margin-bottom: 1rem;">
                            <i class="fas fa-check-circle"></i> ‚úì Certificate Uploaded Successfully
                        </h3>
                        <p><strong>Certificate ID:</strong> ${result.certificate_id}</p>
                        <p><strong>Verification Code:</strong> <code style="background: #f8f9fa; padding: 0.5rem; border-radius: 5px;">${result.verification_code}</code></p>
                        <p style="color: #ffc107;">‚è≥ Status: Pending verification</p>
                    `;
                    showResult(resultDiv, html, 'success');
                    showNotification('‚úì Certificate uploaded successfully!');
                } else {
                    showResult(resultDiv, result.error || 'Failed to upload certificate', 'error');
                }
            } catch (error) {
                showResult(resultDiv, 'Error uploading certificate: ' + error.message, 'error');
            }
        }

        // Advanced Dashboard Functions
        async function loadDashboardData() {
            try {
                // Load advanced analytics
                const response = await fetch('/api/analytics/dashboard');
                const data = await response.json();
                
                if (data.success) {
                    const analytics = data.analytics;
                    
                    // Update overview stats
                    document.getElementById('totalCertificates').textContent = analytics.overview.total_issuances;
                    document.getElementById('verifiedCertificates').textContent = analytics.today_stats.verifications;
                    document.getElementById('totalInstitutions').textContent = analytics.overview.total_institutions;
                    document.getElementById('blockchainTransactions').textContent = analytics.overview.total_verifications;
                    
                    // Update growth indicators
                    document.getElementById('certificateGrowth').textContent = `${analytics.today_stats.issuance_growth >= 0 ? '+' : ''}${analytics.today_stats.issuance_growth}%`;
                    document.getElementById('verificationGrowth').textContent = `${analytics.today_stats.verification_growth >= 0 ? '+' : ''}${analytics.today_stats.verification_growth}%`;
                    
                    // Load charts and additional data
                    loadWeeklyTrendsChart(analytics.trends.weekly_data);
                    loadTopInstitutions(analytics.top_institutions);
                    loadDegreeDistribution(analytics.trends.degree_types);
                    loadAPIPerformance(analytics.performance);
                    loadRecentActivity(analytics.recent_activity);
                }
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                // Fallback to basic stats
                loadBasicStats();
            }
        }
        
        async function loadBasicStats() {
            try {
                const response = await fetch('/api/certificate-stats');
                const data = await response.json();
                
                if (data.success) {
                    const stats = data.statistics;
                    document.getElementById('totalCertificates').textContent = stats.total_certificates;
                    document.getElementById('verifiedCertificates').textContent = stats.verified_certificates;
                    document.getElementById('totalInstitutions').textContent = stats.total_institutions;
                    document.getElementById('blockchainTransactions').textContent = stats.blockchain_transactions || 0;
                }
            } catch (error) {
                console.error('Error loading basic stats:', error);
            }
        }
        
        function loadWeeklyTrendsChart(weeklyData) {
            const canvas = document.getElementById('weeklyTrendsChart');
            const ctx = canvas.getContext('2d');
            
            // Simple chart implementation (you can replace with Chart.js for production)
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (!weeklyData || !weeklyData.dates) {
                ctx.fillStyle = '#666';
                ctx.font = '14px Arial';
                ctx.fillText('No trend data available', 50, 100);
                return;
            }
            
            // Draw simple line chart
            const maxValue = Math.max(...weeklyData.verifications, ...weeklyData.issuances, 1);
            const chartHeight = 150;
            const chartWidth = canvas.width - 100;
            
            // Draw axes
            ctx.strokeStyle = '#ddd';
            ctx.beginPath();
            ctx.moveTo(50, 20);
            ctx.lineTo(50, chartHeight + 20);
            ctx.lineTo(chartWidth + 50, chartHeight + 20);
            ctx.stroke();
            
            // Draw verification line
            ctx.strokeStyle = '#28a745';
            ctx.lineWidth = 2;
            ctx.beginPath();
            for (let i = 0; i < weeklyData.verifications.length; i++) {
                const x = 50 + (i * chartWidth / (weeklyData.verifications.length - 1));
                const y = 20 + chartHeight - (weeklyData.verifications[i] / maxValue * chartHeight);
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
            
            // Draw issuance line
            ctx.strokeStyle = '#667eea';
            ctx.beginPath();
            for (let i = 0; i < weeklyData.issuances.length; i++) {
                const x = 50 + (i * chartWidth / (weeklyData.issuances.length - 1));
                const y = 20 + chartHeight - (weeklyData.issuances[i] / maxValue * chartHeight);
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
            
            // Add legend
            ctx.fillStyle = '#28a745';
            ctx.fillRect(60, chartHeight + 30, 15, 10);
            ctx.fillStyle = '#333';
            ctx.font = '12px Arial';
            ctx.fillText('Verifications', 80, chartHeight + 40);
            
            ctx.fillStyle = '#667eea';
            ctx.fillRect(180, chartHeight + 30, 15, 10);
            ctx.fillText('Issuances', 200, chartHeight + 40);
        }
        
        function loadTopInstitutions(institutions) {
            const container = document.getElementById('topInstitutions');
            
            if (!institutions || institutions.length === 0) {
                container.innerHTML = '<p style="color: #666;">No institution data available</p>';
                return;
            }
            
            let html = '';
            institutions.slice(0, 5).forEach((inst, index) => {
                html += `
                    <div class="institution-item">
                        <div>
                            <div style="font-weight: bold; font-size: 0.9rem;">#${index + 1} Institution</div>
                            <div style="font-size: 0.8rem; color: #666;">${inst.institution_id}</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-weight: bold; color: #667eea;">${inst.total_activity}</div>
                            <div style="font-size: 0.8rem; color: #666;">activities</div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function loadDegreeDistribution(degreeTypes) {
            const container = document.getElementById('degreeDistribution');
            
            if (!degreeTypes || Object.keys(degreeTypes).length === 0) {
                container.innerHTML = '<p style="color: #666;">No degree data available</p>';
                return;
            }
            
            const maxCount = Math.max(...Object.values(degreeTypes));
            let html = '';
            
            Object.entries(degreeTypes).slice(0, 5).forEach(([degree, count]) => {
                const percentage = (count / maxCount) * 100;
                html += `
                    <div class="degree-item">
                        <div>
                            <div style="font-weight: bold; font-size: 0.9rem;">${degree}</div>
                            <div class="degree-bar" style="width: ${percentage}%;"></div>
                        </div>
                        <div style="font-weight: bold; color: #667eea;">${count}</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function loadAPIPerformance(performance) {
            const container = document.getElementById('apiPerformance');
            
            if (!performance || Object.keys(performance).length === 0) {
                container.innerHTML = '<p style="color: #666;">No performance data available</p>';
                return;
            }
            
            let html = '';
            Object.entries(performance).slice(0, 5).forEach(([endpoint, metrics]) => {
                const endpointName = endpoint.split('/').pop() || endpoint;
                html += `
                    <div class="performance-metric">
                        <div>
                            <div style="font-weight: bold; font-size: 0.9rem;">${endpointName}</div>
                            <div style="font-size: 0.8rem; color: #666;">${metrics.requests} requests</div>
                        </div>
                        <div class="metric-value">${metrics.avg_response_time}ms</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function loadRecentActivity(recentActivity) {
            const container = document.getElementById('recentActivity');
            
            if (!recentActivity) {
                container.innerHTML = '<p style="color: #666;">No recent activity data available</p>';
                return;
            }
            
            let html = '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">';
            
            // Recent Verifications
            html += '<div><h4>Recent Verifications</h4>';
            if (recentActivity.verifications && recentActivity.verifications.length > 0) {
                recentActivity.verifications.slice(0, 3).forEach(verification => {
                    html += `
                        <div style="padding: 0.8rem; margin: 0.5rem 0; background: #e8f5e8; border-radius: 8px;">
                            <div style="font-weight: bold;">${verification.student_name}</div>
                            <div style="font-size: 0.8rem; color: #666;">${verification.institution_name}</div>
                            <div style="font-size: 0.8rem; color: #666;">${new Date(verification.timestamp).toLocaleString()}</div>
                        </div>
                    `;
                });
            } else {
                html += '<p style="color: #666;">No recent verifications</p>';
            }
            html += '</div>';
            
            // Recent Issuances
            html += '<div><h4>Recent Issuances</h4>';
            if (recentActivity.issuances && recentActivity.issuances.length > 0) {
                recentActivity.issuances.slice(0, 3).forEach(issuance => {
                    html += `
                        <div style="padding: 0.8rem; margin: 0.5rem 0; background: #e3f2fd; border-radius: 8px;">
                            <div style="font-weight: bold;">${issuance.student_name}</div>
                            <div style="font-size: 0.8rem; color: #666;">${issuance.degree_type}</div>
                            <div style="font-size: 0.8rem; color: #666;">${new Date(issuance.timestamp).toLocaleString()}</div>
                        </div>
                    `;
                });
            } else {
                html += '<p style="color: #666;">No recent issuances</p>';
            }
            html += '</div>';
            
            html += '</div>';
            container.innerHTML = html;
        }

        // Initialize dashboard with sample data if no analytics available
        function initializeDashboardWithSampleData() {
            // Add sample data for demonstration
            const sampleData = {
                overview: {
                    total_issuances: 156,
                    total_verifications: 342,
                    total_institutions: 45,
                    active_certificates: 156
                },
                today_stats: {
                    verifications: 23,
                    issuances: 8,
                    verification_growth: 15.2,
                    issuance_growth: 12.5
                },
                trends: {
                    weekly_data: {
                        dates: ['2025-09-22', '2025-09-23', '2025-09-24', '2025-09-25', '2025-09-26', '2025-09-27', '2025-09-28'],
                        verifications: [12, 18, 25, 31, 28, 35, 23],
                        issuances: [5, 8, 12, 15, 11, 18, 8]
                    },
                    degree_types: {
                        'Bachelor of Engineering': 45,
                        'Master of Science': 32,
                        'Bachelor of Technology': 28,
                        'Master of Business Administration': 22,
                        'Bachelor of Science': 18
                    },
                    fields_of_study: {
                        'Computer Science': 38,
                        'Electronics & Communication': 29,
                        'Mechanical Engineering': 25,
                        'Information Technology': 21,
                        'Civil Engineering': 18
                    }
                },
                top_institutions: [
                    { institution_id: 'iitm_001', total_activity: 87, verifications: 52, issuances: 35, certificates: 35 },
                    { institution_id: 'anna_001', total_activity: 64, verifications: 38, issuances: 26, certificates: 26 },
                    { institution_id: 'loyola_001', total_activity: 43, verifications: 28, issuances: 15, certificates: 15 },
                    { institution_id: 'vit_001', total_activity: 39, verifications: 24, issuances: 15, certificates: 15 },
                    { institution_id: 'srmist_001', total_activity: 31, verifications: 19, issuances: 12, certificates: 12 }
                ],
                performance: {
                    '/api/verify-certificate': { requests: 342, avg_response_time: 0.245, min_response_time: 0.123, max_response_time: 0.567 },
                    '/api/issue-credential': { requests: 156, avg_response_time: 0.389, min_response_time: 0.201, max_response_time: 0.892 },
                    '/api/blockchain-explorer': { requests: 89, avg_response_time: 0.156, min_response_time: 0.098, max_response_time: 0.234 },
                    '/api/generate-certificate': { requests: 67, avg_response_time: 0.678, min_response_time: 0.345, max_response_time: 1.234 }
                },
                recent_activity: {
                    verifications: [
                        { student_name: 'Rahul Sharma', institution_name: 'IIT Madras', timestamp: new Date(Date.now() - 300000).toISOString() },
                        { student_name: 'Priya Patel', institution_name: 'Loyola College', timestamp: new Date(Date.now() - 600000).toISOString() },
                        { student_name: 'Arjun Kumar', institution_name: 'Anna University', timestamp: new Date(Date.now() - 900000).toISOString() }
                    ],
                    issuances: [
                        { student_name: 'Sneha Singh', degree_type: 'B.Tech Computer Science', timestamp: new Date(Date.now() - 1200000).toISOString() },
                        { student_name: 'Vikram Reddy', degree_type: 'M.Sc Data Science', timestamp: new Date(Date.now() - 1500000).toISOString() },
                        { student_name: 'Kavya Nair', degree_type: 'B.E Electronics', timestamp: new Date(Date.now() - 1800000).toISOString() }
                    ]
                }
            };
            
            // Update dashboard with sample data
            updateDashboardDisplay(sampleData);
        }
        
        function updateDashboardDisplay(analytics) {
            // Update overview stats
            document.getElementById('totalCertificates').textContent = analytics.overview.total_issuances;
            document.getElementById('verifiedCertificates').textContent = analytics.today_stats.verifications;
            document.getElementById('totalInstitutions').textContent = analytics.overview.total_institutions;
            document.getElementById('blockchainTransactions').textContent = analytics.overview.total_verifications;
            
            // Update growth indicators
            const verificationGrowth = analytics.today_stats.verification_growth;
            const issuanceGrowth = analytics.today_stats.issuance_growth;
            
            document.getElementById('certificateGrowth').textContent = `${issuanceGrowth >= 0 ? '+' : ''}${issuanceGrowth}%`;
            document.getElementById('verificationGrowth').textContent = `${verificationGrowth >= 0 ? '+' : ''}${verificationGrowth}%`;
            
            // Set growth colors
            document.getElementById('certificateGrowth').style.color = issuanceGrowth >= 0 ? '#28a745' : '#dc3545';
            document.getElementById('verificationGrowth').style.color = verificationGrowth >= 0 ? '#28a745' : '#dc3545';
            
            // Load charts and additional data
            loadWeeklyTrendsChart(analytics.trends.weekly_data);
            loadTopInstitutions(analytics.top_institutions);
            loadDegreeDistribution(analytics.trends.degree_types);
            loadAPIPerformance(analytics.performance);
            loadRecentActivity(analytics.recent_activity);
        }

        // Helper Functions
        function showResult(container, content, type) {
            container.innerHTML = content;
            container.className = `result-container result-${type}`;
            container.style.display = 'block';
            container.scrollIntoView({ behavior: 'smooth' });
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Drag and Drop for Upload
        const uploadArea = document.querySelector('.upload-area');
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                document.getElementById('fileInput').files = files;
                handleFileSelect(document.getElementById('fileInput'));
            }
        });

        // Institution Management
        let institutionsData = [];
        
        async function loadInstitutions() {
            try {
                const response = await fetch('/api/colleges');
                const data = await response.json();
                institutionsData = data.colleges || [];
                console.log(`Loaded ${institutionsData.length} institutions from Tamil Nadu`);
            } catch (error) {
                console.error('Error loading institutions:', error);
            }
        }
        
        function searchInstitutions(query) {
            const datalist = document.getElementById('institutionsList');
            datalist.innerHTML = '';
            
            if (query.length < 2) return;
            
            const matches = institutionsData.filter(inst => 
                inst.name.toLowerCase().includes(query.toLowerCase()) ||
                inst.location.toLowerCase().includes(query.toLowerCase())
            ).slice(0, 10); // Limit to 10 results
            
            matches.forEach(inst => {
                const option = document.createElement('option');
                option.value = inst.name;
                option.setAttribute('data-id', inst.institution_id);
                option.setAttribute('data-location', inst.location);
                datalist.appendChild(option);
            });
        }
        
        function fillInstitutionId(institutionName) {
            // Find the institution by name and auto-fill the ID
            const institution = institutionsData.find(inst => 
                inst.name.toLowerCase() === institutionName.toLowerCase()
            );
            
            if (institution) {
                document.getElementById('institutionId').value = institution.institution_id;
                showNotification(`‚úì Institution ID auto-filled: ${institution.institution_id}`);
            } else {
                document.getElementById('institutionId').value = '';
            }
        }
        
        // Certificate Generation Functions
        function showCertificateForm(type) {
            const container = document.getElementById('certificateForms');
            
            if (!type) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #666;">
                        <i class="fas fa-arrow-up" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
                        <p style="font-size: 1.1rem;">Please select a certificate type from the dropdown above</p>
                    </div>
                `;
                return;
            }
            
            const forms = {
                sslc: getSSLCForm(),
                hsc1: getHSC1Form(),
                hsc2: getHSC2Form(),
                degree: getDegreeForm(),
                income: getIncomeForm(),
                community: getCommunityForm(),
                nativity: getNativityForm(),
                transfer: getTransferForm(),
                firstgraduate: getFirstGraduateForm()
            };
            
            container.innerHTML = forms[type] || '<p>Form not available</p>';
        }
        
        function getSSLCForm() {
            return `
                <div style="background: white; padding: 2rem; border-radius: 10px; border: 2px solid #2c5f8d;">
                    <h3 style="color: #2c5f8d; margin-bottom: 1.5rem;">
                        <i class="fas fa-graduation-cap"></i> SSLC Certificate (10th Standard)
                    </h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Certificate Serial No *</label>
                            <input type="text" id="sslc_cert_no" class="form-input" placeholder="SSLC/2024/12345">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Student Name *</label>
                            <input type="text" id="sslc_name" class="form-input" placeholder="Full Name">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Father's Name *</label>
                            <input type="text" id="sslc_father" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Mother's Name *</label>
                            <input type="text" id="sslc_mother" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Date of Birth *</label>
                            <input type="date" id="sslc_dob" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Register Number *</label>
                            <input type="text" id="sslc_reg" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Exam Month & Year *</label>
                            <input type="text" id="sslc_exam" class="form-input" placeholder="MARCH 2024">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Roll Number *</label>
                            <input type="text" id="sslc_roll" class="form-input">
                        </div>
                    </div>
                    
                    <h4 style="margin: 1.5rem 0 1rem 0; color: #2c5f8d;">Subject Marks (out of 100)</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Tamil *</label>
                            <input type="number" id="sslc_tamil" class="form-input" max="100" onchange="calculateSSLCTotal()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">English *</label>
                            <input type="number" id="sslc_english" class="form-input" max="100" onchange="calculateSSLCTotal()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Mathematics *</label>
                            <input type="number" id="sslc_math" class="form-input" max="100" onchange="calculateSSLCTotal()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Science *</label>
                            <input type="number" id="sslc_science" class="form-input" max="100" onchange="calculateSSLCTotal()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Social Science *</label>
                            <input type="number" id="sslc_social" class="form-input" max="100" onchange="calculateSSLCTotal()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Total Marks</label>
                            <input type="text" id="sslc_total" class="form-input" readonly style="background: #ffd700; font-weight: bold;">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                        <div class="form-group">
                            <label class="form-label">School Name *</label>
                            <input type="text" id="sslc_school" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">School Code *</label>
                            <input type="text" id="sslc_school_code" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Medium of Instruction *</label>
                            <select id="sslc_medium" class="form-input">
                                <option value="ENGLISH">English</option>
                                <option value="TAMIL">Tamil</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 2rem;">
                        <button class="btn btn-success" onclick="generateSSLCCertificate()">
                            <i class="fas fa-certificate"></i> Issue Credential
                        </button>
                    </div>
                </div>
            `;
        }
        
        function calculateSSLCTotal() {
            const tamil = parseInt(document.getElementById('sslc_tamil').value) || 0;
            const english = parseInt(document.getElementById('sslc_english').value) || 0;
            const math = parseInt(document.getElementById('sslc_math').value) || 0;
            const science = parseInt(document.getElementById('sslc_science').value) || 0;
            const social = parseInt(document.getElementById('sslc_social').value) || 0;
            
            const total = tamil + english + math + science + social;
            document.getElementById('sslc_total').value = total + ' / 500';
        }
        
        async function generateSSLCCertificate() {
            const data = {
                certificate_sl_no: document.getElementById('sslc_cert_no').value,
                candidate_name: document.getElementById('sslc_name').value,
                father_name: document.getElementById('sslc_father').value,
                mother_name: document.getElementById('sslc_mother').value,
                dob: document.getElementById('sslc_dob').value,
                reg_no: document.getElementById('sslc_reg').value,
                exam_month_year: document.getElementById('sslc_exam').value,
                roll_no: document.getElementById('sslc_roll').value,
                tamil_marks: document.getElementById('sslc_tamil').value,
                english_marks: document.getElementById('sslc_english').value,
                math_marks: document.getElementById('sslc_math').value,
                science_marks: document.getElementById('sslc_science').value,
                social_marks: document.getElementById('sslc_social').value,
                total_marks: (parseInt(document.getElementById('sslc_tamil').value) || 0) +
                            (parseInt(document.getElementById('sslc_english').value) || 0) +
                            (parseInt(document.getElementById('sslc_math').value) || 0) +
                            (parseInt(document.getElementById('sslc_science').value) || 0) +
                            (parseInt(document.getElementById('sslc_social').value) || 0),
                school_name: document.getElementById('sslc_school').value,
                school_code: document.getElementById('sslc_school_code').value,
                medium: document.getElementById('sslc_medium').value
            };
            
            try {
                // Generate certificate HTML
                const certResponse = await fetch('/api/generate-sslc-certificate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const certResult = await certResponse.json();
                
                if (!certResult.success) {
                    showNotification('‚ùå Error: ' + certResult.error);
                    return;
                }
                
                // Issue credential to blockchain (without auto-mining)
                const credentialData = {
                    studentName: data.candidate_name,
                    studentId: data.reg_no,
                    institutionName: data.school_name,
                    institutionId: data.school_code,
                    degreeType: 'SSLC Certificate',
                    fieldOfStudy: 'Secondary Education',
                    graduationDate: data.exam_month_year,
                    grade: data.total_marks + '/500',
                    certificateType: 'SSLC',
                    certificateData: data
                };
                
                const issueResponse = await fetch('/api/issue-credential', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(credentialData)
                });
                
                const issueResult = await issueResponse.json();
                
                if (issueResult.success) {
                    showCertificateWithVerification(certResult.html, 'SSLC Certificate', issueResult.verification_code, issueResult.message);
                } else {
                    showNotification('‚ùå Error issuing credential: ' + issueResult.error);
                }
            } catch (error) {
                showNotification('‚ùå Error: ' + error.message);
            }
        }
        
        let currentCertificateHtml = '';
        
        function showCertificateWithVerification(html, title, verificationCode, message) {
            currentCertificateHtml = html;
            const resultDiv = document.getElementById('issueResult');
            resultDiv.innerHTML = `
                <div style="background: white; padding: 2rem; border-radius: 10px; margin-top: 2rem; border: 3px solid #28a745; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    <h3 style="color: #28a745; margin-bottom: 1.5rem; font-size: 1.8rem;">
                        <i class="fas fa-check-circle"></i> ${title} Issued Successfully!
                    </h3>
                    
                    <!-- Verification Code Box -->
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: 3px solid #5a67d8; padding: 2rem; border-radius: 12px; margin-bottom: 1.5rem; box-shadow: 0 4px 12px rgba(102,126,234,0.4);">
                        <h4 style="color: white; margin: 0 0 1rem 0; font-size: 1.3rem; text-align: center;">
                            <i class="fas fa-key"></i> YOUR VERIFICATION CODE
                        </h4>
                        <div style="background: white; padding: 1.5rem; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 2rem; font-weight: bold; text-align: center; color: #667eea; letter-spacing: 4px; border: 2px dashed #667eea;">
                            ${verificationCode}
                        </div>
                        <p style="margin: 1rem 0 0 0; color: white; font-size: 1rem; text-align: center;">
                            <i class="fas fa-info-circle"></i> <strong>IMPORTANT:</strong> Save this code - you'll need it to verify your certificate!
                        </p>
                    </div>
                    
                    <!-- Warning Banner -->
                    <div style="background: #fff3cd; border: 2px solid #ffc107; padding: 1.2rem; border-radius: 8px; margin-bottom: 1.5rem;">
                        <p style="margin: 0; color: #856404; font-size: 1rem;">
                            <i class="fas fa-exclamation-triangle"></i> <strong>Next Step:</strong> Your certificate is in pending transactions. 
                            Click <strong>"Go to Mine Block"</strong> below to add it to the blockchain permanently.
                        </p>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                        <button class="btn btn-primary" onclick="copyVerificationCode('${verificationCode}')" style="padding: 1rem; font-size: 1rem;">
                            <i class="fas fa-copy"></i> Copy Code
                        </button>
                        <button class="btn btn-success" onclick="toggleCertificateView()" style="padding: 1rem; font-size: 1rem;">
                            <i class="fas fa-eye"></i> View Certificate
                        </button>
                        <button class="btn btn-info" onclick="openCertificateNewWindow()" style="padding: 1rem; font-size: 1rem;">
                            <i class="fas fa-external-link-alt"></i> Open in New Window
                        </button>
                        <button class="btn btn-warning" onclick="showTab('blockchain')" style="padding: 1rem; font-size: 1rem;">
                            <i class="fas fa-cube"></i> Go to Mine Block
                        </button>
                    </div>
                    
                    <!-- Certificate Preview (Hidden by default) -->
                    <div id="certificatePreview" style="display: none; border: 3px solid #28a745; padding: 1rem; border-radius: 8px; background: #f9f9f9; margin-top: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid #28a745;">
                            <h4 style="margin: 0; color: #28a745;">
                                <i class="fas fa-certificate"></i> Certificate Preview
                            </h4>
                            <button class="btn btn-sm btn-secondary" onclick="toggleCertificateView()">
                                <i class="fas fa-times"></i> Hide
                            </button>
                        </div>
                        <div style="max-height: 600px; overflow-y: auto; background: white; padding: 1rem; border-radius: 5px;">
                            ${html}
                        </div>
                    </div>
                </div>
            `;
            resultDiv.style.display = 'block';
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        
        function toggleCertificateView() {
            const preview = document.getElementById('certificatePreview');
            if (preview) {
                if (preview.style.display === 'none') {
                    preview.style.display = 'block';
                    preview.scrollIntoView({ behavior: 'smooth' });
                } else {
                    preview.style.display = 'none';
                }
            }
        }
        
        function openCertificateNewWindow() {
            if (currentCertificateHtml) {
                const newWindow = window.open('', '_blank', 'width=900,height=800');
                newWindow.document.write(currentCertificateHtml);
                newWindow.document.close();
            } else {
                showNotification('‚ùå No certificate to display');
            }
        }
        
        function copyVerificationCode(code) {
            navigator.clipboard.writeText(code).then(() => {
                showNotification('‚úÖ Verification code copied to clipboard!');
            }).catch(() => {
                showNotification('‚ùå Failed to copy code');
            });
        }
        
        function showCertificatePreview(html, title) {
            const resultDiv = document.getElementById('issueResult');
            resultDiv.innerHTML = `
                <div style="background: white; padding: 2rem; border-radius: 10px; margin-top: 2rem;">
                    <h3 style="color: #28a745; margin-bottom: 1rem;">
                        <i class="fas fa-check-circle"></i> ${title} Generated Successfully!
                    </h3>
                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                        <button class="btn btn-primary" onclick="downloadCertificate()">
                            <i class="fas fa-download"></i> Download Certificate
                        </button>
                        <button class="btn btn-secondary" onclick="printCertificate()">
                            <i class="fas fa-print"></i> Print Certificate
                        </button>
                    </div>
                    <div style="border: 2px solid #ddd; padding: 1rem; max-height: 600px; overflow-y: auto; background: #f9f9f9;">
                        ${html}
                    </div>
                </div>
            `;
            resultDiv.scrollIntoView({ behavior: 'smooth' });
        }
        
        function downloadCertificate() {
            showNotification('üìÑ Certificate download feature coming soon!');
        }
        
        function printCertificate() {
            window.print();
        }
        
        // HSC Certificate Forms
        function getHSC1Form() {
            return `
                <div style="background: white; padding: 2rem; border-radius: 10px; border: 2px solid #c6716c;">
                    <h3 style="color: #c6716c; margin-bottom: 1.5rem;">
                        <i class="fas fa-graduation-cap"></i> HSC First Year Certificate (11th Standard)
                    </h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Certificate Serial No *</label>
                            <input type="text" id="hsc1_cert_no" class="form-input" placeholder="HSC1/2024/12345">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Student Name *</label>
                            <input type="text" id="hsc1_name" class="form-input" placeholder="Full Name">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Date of Birth *</label>
                            <input type="date" id="hsc1_dob" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Permanent Register Number *</label>
                            <input type="text" id="hsc1_reg" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Exam Month & Year *</label>
                            <input type="text" id="hsc1_exam" class="form-input" placeholder="MARCH 2024">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Group Code & Name *</label>
                            <input type="text" id="hsc1_group" class="form-input" placeholder="Group 1 - Bio-Maths">
                        </div>
                    </div>
                    
                    <h4 style="margin: 1.5rem 0 1rem 0; color: #c6716c;">Subject Marks (out of 100)</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Tamil *</label>
                            <input type="number" id="hsc1_tamil" class="form-input" max="100" onchange="calculateHSC1Total()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">English *</label>
                            <input type="number" id="hsc1_english" class="form-input" max="100" onchange="calculateHSC1Total()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Physics *</label>
                            <input type="number" id="hsc1_physics" class="form-input" max="100" onchange="calculateHSC1Total()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Chemistry *</label>
                            <input type="number" id="hsc1_chemistry" class="form-input" max="100" onchange="calculateHSC1Total()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Biology *</label>
                            <input type="number" id="hsc1_biology" class="form-input" max="100" onchange="calculateHSC1Total()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Mathematics *</label>
                            <input type="number" id="hsc1_math" class="form-input" max="100" onchange="calculateHSC1Total()">
                        </div>
                        <div class="form-group" style="grid-column: span 3;">
                            <label class="form-label">Total Marks</label>
                            <input type="text" id="hsc1_total" class="form-input" readonly style="background: #ffd700; font-weight: bold; text-align: center; font-size: 1.2rem;">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                        <div class="form-group">
                            <label class="form-label">School Name *</label>
                            <input type="text" id="hsc1_school" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Medium of Instruction *</label>
                            <select id="hsc1_medium" class="form-input">
                                <option value="ENGLISH">English</option>
                                <option value="TAMIL">Tamil</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 2rem;">
                        <button class="btn btn-success" onclick="generateHSC1Certificate()">
                            <i class="fas fa-certificate"></i> Issue Credential - HSC First Year Certificate
                        </button>
                    </div>
                </div>
            `;
        }
        
        function calculateHSC1Total() {
            const tamil = parseInt(document.getElementById('hsc1_tamil').value) || 0;
            const english = parseInt(document.getElementById('hsc1_english').value) || 0;
            const physics = parseInt(document.getElementById('hsc1_physics').value) || 0;
            const chemistry = parseInt(document.getElementById('hsc1_chemistry').value) || 0;
            const biology = parseInt(document.getElementById('hsc1_biology').value) || 0;
            const math = parseInt(document.getElementById('hsc1_math').value) || 0;
            
            const total = tamil + english + physics + chemistry + biology + math;
            document.getElementById('hsc1_total').value = total + ' / 600';
        }
        
        async function generateHSC1Certificate() {
            // Validate required fields
            const certNo = document.getElementById('hsc1_cert_no').value;
            const name = document.getElementById('hsc1_name').value;
            const dob = document.getElementById('hsc1_dob').value;
            const regNo = document.getElementById('hsc1_reg').value;
            
            if (!certNo || !name || !dob || !regNo) {
                showNotification('‚ùå Please fill all required fields marked with *');
                return;
            }
            
            const data = {
                certificate_sl_no: certNo,
                candidate_name: name,
                dob: dob,
                reg_no: regNo,
                exam_month_year: document.getElementById('hsc1_exam').value || 'MARCH 2024',
                group_code_name: document.getElementById('hsc1_group').value || 'Group 1',
                tamil_marks: document.getElementById('hsc1_tamil').value || '0',
                english_marks: document.getElementById('hsc1_english').value || '0',
                physics_marks: document.getElementById('hsc1_physics').value || '0',
                chemistry_marks: document.getElementById('hsc1_chemistry').value || '0',
                biology_marks: document.getElementById('hsc1_biology').value || '0',
                math_marks: document.getElementById('hsc1_math').value || '0',
                total_marks: (parseInt(document.getElementById('hsc1_tamil').value) || 0) +
                            (parseInt(document.getElementById('hsc1_english').value) || 0) +
                            (parseInt(document.getElementById('hsc1_physics').value) || 0) +
                            (parseInt(document.getElementById('hsc1_chemistry').value) || 0) +
                            (parseInt(document.getElementById('hsc1_biology').value) || 0) +
                            (parseInt(document.getElementById('hsc1_math').value) || 0),
                school_name: document.getElementById('hsc1_school').value || 'School Name',
                medium: document.getElementById('hsc1_medium').value || 'ENGLISH'
            };
            
            try {
                showNotification('‚è≥ Generating HSC First Year Certificate...');
                
                const certResponse = await fetch('/api/generate-hsc1-certificate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (!certResponse.ok) {
                    throw new Error(`HTTP error! status: ${certResponse.status}`);
                }
                
                const certResult = await certResponse.json();
                console.log('Certificate Result:', certResult);
                
                if (!certResult.success) {
                    showNotification('‚ùå Certificate Error: ' + (certResult.error || 'Unknown error'));
                    return;
                }
                
                showNotification('‚è≥ Issuing credential to blockchain...');
                
                const credentialData = {
                    studentName: data.candidate_name,
                    studentId: data.reg_no,
                    institutionName: data.school_name,
                    institutionId: 'TN-BOARD',
                    degreeType: 'HSC First Year Certificate',
                    fieldOfStudy: 'Higher Secondary - First Year',
                    graduationDate: data.exam_month_year,
                    grade: data.total_marks + '/600',
                    certificateType: 'HSC_FIRST_YEAR',
                    certificateData: data
                };
                
                const issueResponse = await fetch('/api/issue-credential', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(credentialData)
                });
                
                if (!issueResponse.ok) {
                    throw new Error(`HTTP error! status: ${issueResponse.status}`);
                }
                
                const issueResult = await issueResponse.json();
                console.log('Issue Result:', issueResult);
                
                if (issueResult.success) {
                    showCertificateWithVerification(certResult.html, 'HSC First Year Certificate', issueResult.verification_code, issueResult.message);
                    showNotification('‚úÖ HSC First Year Certificate issued successfully!');
                } else {
                    showNotification('‚ùå Blockchain Error: ' + (issueResult.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('‚ùå Error: ' + error.message);
            }
        }
        
        function getHSC2Form() {
            return `
                <div style="background: white; padding: 2rem; border-radius: 10px; border: 2px solid #73B6E2;">
                    <h3 style="color: #1e5a8e; margin-bottom: 1.5rem;">
                        <i class="fas fa-graduation-cap"></i> HSC Second Year Certificate (12th Standard)
                    </h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Certificate Serial No *</label>
                            <input type="text" id="hsc2_cert_no" class="form-input" placeholder="HSC2/2024/12345">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Student Name *</label>
                            <input type="text" id="hsc2_name" class="form-input" placeholder="Full Name">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Date of Birth *</label>
                            <input type="date" id="hsc2_dob" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Permanent Register Number *</label>
                            <input type="text" id="hsc2_reg" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Exam Month & Year *</label>
                            <input type="text" id="hsc2_exam" class="form-input" placeholder="MARCH 2024">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Group Code & Name *</label>
                            <input type="text" id="hsc2_group" class="form-input" placeholder="Group 1 - Bio-Maths">
                        </div>
                    </div>
                    
                    <h4 style="margin: 1.5rem 0 1rem 0; color: #1e5a8e;">Subject Marks (out of 100)</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Tamil *</label>
                            <input type="number" id="hsc2_tamil" class="form-input" max="100" onchange="calculateHSC2Total()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">English *</label>
                            <input type="number" id="hsc2_english" class="form-input" max="100" onchange="calculateHSC2Total()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Physics *</label>
                            <input type="number" id="hsc2_physics" class="form-input" max="100" onchange="calculateHSC2Total()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Chemistry *</label>
                            <input type="number" id="hsc2_chemistry" class="form-input" max="100" onchange="calculateHSC2Total()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Biology *</label>
                            <input type="number" id="hsc2_biology" class="form-input" max="100" onchange="calculateHSC2Total()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Mathematics *</label>
                            <input type="number" id="hsc2_math" class="form-input" max="100" onchange="calculateHSC2Total()">
                        </div>
                        <div class="form-group" style="grid-column: span 3;">
                            <label class="form-label">Total Marks</label>
                            <input type="text" id="hsc2_total" class="form-input" readonly style="background: #ffd700; font-weight: bold; text-align: center; font-size: 1.2rem;">
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                        <div class="form-group">
                            <label class="form-label">School Name *</label>
                            <input type="text" id="hsc2_school" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Medium of Instruction *</label>
                            <select id="hsc2_medium" class="form-input">
                                <option value="ENGLISH">English</option>
                                <option value="TAMIL">Tamil</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Result *</label>
                            <select id="hsc2_result" class="form-input">
                                <option value="PASSED">PASSED</option>
                                <option value="PASSED WITH DISTINCTION">PASSED WITH DISTINCTION</option>
                                <option value="PASSED WITH FIRST CLASS">PASSED WITH FIRST CLASS</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 2rem;">
                        <button class="btn btn-success" onclick="generateHSC2Certificate()">
                            <i class="fas fa-certificate"></i> Issue Credential - HSC Second Year Certificate
                        </button>
                    </div>
                </div>
            `;
        }
        
        function calculateHSC2Total() {
            const tamil = parseInt(document.getElementById('hsc2_tamil').value) || 0;
            const english = parseInt(document.getElementById('hsc2_english').value) || 0;
            const physics = parseInt(document.getElementById('hsc2_physics').value) || 0;
            const chemistry = parseInt(document.getElementById('hsc2_chemistry').value) || 0;
            const biology = parseInt(document.getElementById('hsc2_biology').value) || 0;
            const math = parseInt(document.getElementById('hsc2_math').value) || 0;
            
            const total = tamil + english + physics + chemistry + biology + math;
            document.getElementById('hsc2_total').value = total + ' / 600';
        }
        
        async function generateHSC2Certificate() {
            // Validate required fields
            const certNo = document.getElementById('hsc2_cert_no').value;
            const name = document.getElementById('hsc2_name').value;
            const dob = document.getElementById('hsc2_dob').value;
            const regNo = document.getElementById('hsc2_reg').value;
            
            if (!certNo || !name || !dob || !regNo) {
                showNotification('‚ùå Please fill all required fields marked with *');
                return;
            }
            
            const data = {
                certificate_sl_no: certNo,
                candidate_name: name,
                dob: dob,
                reg_no: regNo,
                exam_month_year: document.getElementById('hsc2_exam').value || 'MARCH 2024',
                group_code_name: document.getElementById('hsc2_group').value || 'Group 1',
                tamil_marks: document.getElementById('hsc2_tamil').value || '0',
                english_marks: document.getElementById('hsc2_english').value || '0',
                physics_marks: document.getElementById('hsc2_physics').value || '0',
                chemistry_marks: document.getElementById('hsc2_chemistry').value || '0',
                biology_marks: document.getElementById('hsc2_biology').value || '0',
                math_marks: document.getElementById('hsc2_math').value || '0',
                total_marks: (parseInt(document.getElementById('hsc2_tamil').value) || 0) +
                            (parseInt(document.getElementById('hsc2_english').value) || 0) +
                            (parseInt(document.getElementById('hsc2_physics').value) || 0) +
                            (parseInt(document.getElementById('hsc2_chemistry').value) || 0) +
                            (parseInt(document.getElementById('hsc2_biology').value) || 0) +
                            (parseInt(document.getElementById('hsc2_math').value) || 0),
                school_name: document.getElementById('hsc2_school').value || 'School Name',
                medium: document.getElementById('hsc2_medium').value || 'ENGLISH',
                result: document.getElementById('hsc2_result').value || 'PASSED'
            };
            
            try {
                showNotification('‚è≥ Generating HSC Second Year Certificate...');
                
                const certResponse = await fetch('/api/generate-hsc2-certificate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (!certResponse.ok) {
                    throw new Error(`HTTP error! status: ${certResponse.status}`);
                }
                
                const certResult = await certResponse.json();
                console.log('Certificate Result:', certResult);
                
                if (!certResult.success) {
                    showNotification('‚ùå Certificate Error: ' + (certResult.error || 'Unknown error'));
                    return;
                }
                
                showNotification('‚è≥ Issuing credential to blockchain...');
                
                const credentialData = {
                    studentName: data.candidate_name,
                    studentId: data.reg_no,
                    institutionName: data.school_name,
                    institutionId: 'TN-BOARD',
                    degreeType: 'HSC Second Year Certificate',
                    fieldOfStudy: 'Higher Secondary - Second Year',
                    graduationDate: data.exam_month_year,
                    grade: data.total_marks + '/600 - ' + data.result,
                    certificateType: 'HSC_SECOND_YEAR',
                    certificateData: data
                };
                
                const issueResponse = await fetch('/api/issue-credential', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(credentialData)
                });
                
                if (!issueResponse.ok) {
                    throw new Error(`HTTP error! status: ${issueResponse.status}`);
                }
                
                const issueResult = await issueResponse.json();
                console.log('Issue Result:', issueResult);
                
                if (issueResult.success) {
                    showCertificateWithVerification(certResult.html, 'HSC Second Year Certificate', issueResult.verification_code, issueResult.message);
                    showNotification('‚úÖ HSC Second Year Certificate issued successfully!');
                } else {
                    showNotification('‚ùå Blockchain Error: ' + (issueResult.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('‚ùå Error: ' + error.message);
            }
        }
        
        function getDegreeForm() {
            return `
                <div style="background: white; padding: 2rem; border-radius: 10px; border: 2px solid #6366f1;">
                    <h3 style="color: #6366f1; margin-bottom: 1.5rem;">
                        <i class="fas fa-university"></i> Degree Certificate (College/University)
                    </h3>
                    <p style="color: #666; margin-bottom: 1rem;">This will use the existing credential system. Click below to use the standard degree form.</p>
                    <div style="text-align: center; padding: 2rem; background: #f0f9ff; border-radius: 8px;">
                        <p style="font-size: 1.1rem; margin-bottom: 1rem;">For college degree certificates, please use the standard credential issuance system with blockchain integration.</p>
                        <p style="color: #666;">This includes Bachelor's, Master's, and PhD degrees with full blockchain verification.</p>
                    </div>
                </div>
            `;
        }
        
        function getIncomeForm() {
            return `
                <div style="background: white; padding: 2rem; border-radius: 10px; border: 2px solid #232e3b;">
                    <h3 style="color: #232e3b; margin-bottom: 1.5rem;">
                        <i class="fas fa-money-bill-wave"></i> Income Certificate
                    </h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Certificate No *</label>
                            <input type="text" id="inc_cert_no" class="form-input" placeholder="INC/2024/12345">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Applicant Name *</label>
                            <input type="text" id="inc_name" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Parent/Guardian Name *</label>
                            <input type="text" id="inc_parent" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Address *</label>
                            <input type="text" id="inc_address" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Taluk *</label>
                            <input type="text" id="inc_taluk" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">District *</label>
                            <input type="text" id="inc_district" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Purpose *</label>
                            <input type="text" id="inc_purpose" class="form-input" placeholder="Educational/Scholarship">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Total Annual Income (‚Çπ) *</label>
                            <input type="number" id="inc_total" class="form-input">
                        </div>
                    </div>
                    
                    <h4 style="margin: 1.5rem 0 1rem 0;">Family Members Income Details</h4>
                    <div id="inc_family_members">
                        <div style="display: grid; grid-template-columns: 2fr 1fr 2fr 1fr auto; gap: 0.5rem; margin-bottom: 0.5rem;">
                            <input type="text" class="form-input" placeholder="Name" id="inc_mem1_name">
                            <input type="text" class="form-input" placeholder="Relation" id="inc_mem1_rel">
                            <input type="text" class="form-input" placeholder="Occupation" id="inc_mem1_occ">
                            <input type="number" class="form-input" placeholder="Income" id="inc_mem1_inc">
                            <button class="btn btn-sm btn-secondary" onclick="addIncomeMember()">+</button>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 2rem;">
                        <button class="btn btn-success" onclick="generateIncomeCertificate()">
                            <i class="fas fa-certificate"></i> Issue Credential - Income Certificate
                        </button>
                    </div>
                </div>
            `;
        }
        
        async function generateIncomeCertificate() {
            const familyMembers = [
                {
                    name: document.getElementById('inc_mem1_name').value,
                    relationship: document.getElementById('inc_mem1_rel').value,
                    occupation: document.getElementById('inc_mem1_occ').value,
                    income: document.getElementById('inc_mem1_inc').value
                }
            ];
            
            const data = {
                certificate_no: document.getElementById('inc_cert_no').value,
                applicant_name: document.getElementById('inc_name').value,
                parent_name: document.getElementById('inc_parent').value,
                address: document.getElementById('inc_address').value,
                taluk: document.getElementById('inc_taluk').value,
                district: document.getElementById('inc_district').value,
                purpose: document.getElementById('inc_purpose').value,
                total_income: document.getElementById('inc_total').value,
                family_members: familyMembers,
                issue_date: new Date().toLocaleDateString('en-GB')
            };
            
            try {
                const certResponse = await fetch('/api/generate-income-certificate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const certResult = await certResponse.json();
                if (!certResult.success) {
                    showNotification('‚ùå Error: ' + certResult.error);
                    return;
                }
                
                const credentialData = {
                    studentName: data.applicant_name,
                    studentId: data.certificate_no,
                    institutionName: data.taluk + ' Taluk Office',
                    institutionId: 'REVENUE-' + data.district,
                    degreeType: 'Income Certificate',
                    fieldOfStudy: 'Government Certificate',
                    graduationDate: data.issue_date,
                    grade: 'Income: ‚Çπ' + data.total_income,
                    certificateType: 'INCOME',
                    certificateData: data
                };
                
                const issueResponse = await fetch('/api/issue-credential', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(credentialData)
                });
                
                const issueResult = await issueResponse.json();
                if (issueResult.success) {
                    showCertificateWithVerification(certResult.html, 'Income Certificate', issueResult.verification_code, issueResult.message);
                } else {
                    showNotification('‚ùå Error: ' + issueResult.error);
                }
            } catch (error) {
                showNotification('‚ùå Error: ' + error.message);
            }
        }
        
        function getCommunityForm() {
            return `
                <div style="background: white; padding: 2rem; border-radius: 10px; border: 2px solid #059669;">
                    <h3 style="color: #059669; margin-bottom: 1.5rem;">
                        <i class="fas fa-users"></i> Community Certificate
                    </h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Certificate No *</label>
                            <input type="text" id="com_cert_no" class="form-input" placeholder="COM/2024/12345">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Applicant Name *</label>
                            <input type="text" id="com_name" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Parent/Guardian Name *</label>
                            <input type="text" id="com_parent" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Date of Birth *</label>
                            <input type="date" id="com_dob" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Address *</label>
                            <input type="text" id="com_address" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Taluk *</label>
                            <input type="text" id="com_taluk" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">District *</label>
                            <input type="text" id="com_district" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Community *</label>
                            <select id="com_community" class="form-input">
                                <option value="BC">BC - Backward Class</option>
                                <option value="MBC">MBC - Most Backward Class</option>
                                <option value="SC">SC - Scheduled Caste</option>
                                <option value="ST">ST - Scheduled Tribe</option>
                                <option value="OC">OC - Other Category</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Community Code *</label>
                            <input type="text" id="com_code" class="form-input" placeholder="BC-001">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Purpose *</label>
                            <input type="text" id="com_purpose" class="form-input" placeholder="Educational">
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 2rem;">
                        <button class="btn btn-success" onclick="generateCommunityCertificate()">
                            <i class="fas fa-certificate"></i> Issue Credential - Community Certificate
                        </button>
                    </div>
                </div>
            `;
        }
        
        async function generateCommunityCertificate() {
            const data = {
                certificate_no: document.getElementById('com_cert_no').value,
                applicant_name: document.getElementById('com_name').value,
                parent_name: document.getElementById('com_parent').value,
                dob: document.getElementById('com_dob').value,
                address: document.getElementById('com_address').value,
                taluk: document.getElementById('com_taluk').value,
                district: document.getElementById('com_district').value,
                community: document.getElementById('com_community').value,
                community_code: document.getElementById('com_code').value,
                purpose: document.getElementById('com_purpose').value,
                issue_date: new Date().toLocaleDateString('en-GB')
            };
            
            try {
                const certResponse = await fetch('/api/generate-community-certificate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const certResult = await certResponse.json();
                if (!certResult.success) {
                    showNotification('‚ùå Error: ' + certResult.error);
                    return;
                }
                
                const credentialData = {
                    studentName: data.applicant_name,
                    studentId: data.certificate_no,
                    institutionName: data.taluk + ' Taluk Office',
                    institutionId: 'REVENUE-' + data.district,
                    degreeType: 'Community Certificate',
                    fieldOfStudy: 'Government Certificate',
                    graduationDate: data.issue_date,
                    grade: 'Community: ' + data.community,
                    certificateType: 'COMMUNITY',
                    certificateData: data
                };
                
                const issueResponse = await fetch('/api/issue-credential', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(credentialData)
                });
                
                const issueResult = await issueResponse.json();
                if (issueResult.success) {
                    showCertificateWithVerification(certResult.html, 'Community Certificate', issueResult.verification_code, issueResult.message);
                } else {
                    showNotification('‚ùå Error: ' + issueResult.error);
                }
            } catch (error) {
                showNotification('‚ùå Error: ' + error.message);
            }
        }
        
        function getNativityForm() {
            return `
                <div style="background: white; padding: 2rem; border-radius: 10px; border: 2px solid #7c3aed;">
                    <h3 style="color: #7c3aed; margin-bottom: 1.5rem;">
                        <i class="fas fa-map-marker-alt"></i> Nativity Certificate
                    </h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Certificate No *</label>
                            <input type="text" id="nat_cert_no" class="form-input" placeholder="NAT/2024/12345">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Applicant Name *</label>
                            <input type="text" id="nat_name" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Parent/Guardian Name *</label>
                            <input type="text" id="nat_parent" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Date of Birth *</label>
                            <input type="date" id="nat_dob" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Address *</label>
                            <input type="text" id="nat_address" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Village/Town *</label>
                            <input type="text" id="nat_village" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Taluk *</label>
                            <input type="text" id="nat_taluk" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">District *</label>
                            <input type="text" id="nat_district" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Years of Residence *</label>
                            <input type="number" id="nat_years" class="form-input" placeholder="20">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Purpose *</label>
                            <input type="text" id="nat_purpose" class="form-input" placeholder="Employment">
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 2rem;">
                        <button class="btn btn-success" onclick="generateNativityCertificate()">
                            <i class="fas fa-certificate"></i> Issue Credential - Nativity Certificate
                        </button>
                    </div>
                </div>
            `;
        }
        
        async function generateNativityCertificate() {
            const data = {
                certificate_no: document.getElementById('nat_cert_no').value,
                applicant_name: document.getElementById('nat_name').value,
                parent_name: document.getElementById('nat_parent').value,
                dob: document.getElementById('nat_dob').value,
                address: document.getElementById('nat_address').value,
                village: document.getElementById('nat_village').value,
                taluk: document.getElementById('nat_taluk').value,
                district: document.getElementById('nat_district').value,
                years_of_residence: document.getElementById('nat_years').value,
                purpose: document.getElementById('nat_purpose').value,
                issue_date: new Date().toLocaleDateString('en-GB')
            };
            
            try {
                const certResponse = await fetch('/api/generate-nativity-certificate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const certResult = await certResponse.json();
                if (!certResult.success) {
                    showNotification('‚ùå Error: ' + certResult.error);
                    return;
                }
                
                const credentialData = {
                    studentName: data.applicant_name,
                    studentId: data.certificate_no,
                    institutionName: data.taluk + ' Taluk Office',
                    institutionId: 'REVENUE-' + data.district,
                    degreeType: 'Nativity Certificate',
                    fieldOfStudy: 'Government Certificate',
                    graduationDate: data.issue_date,
                    grade: 'Native of ' + data.village,
                    certificateType: 'NATIVITY',
                    certificateData: data
                };
                
                const issueResponse = await fetch('/api/issue-credential', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(credentialData)
                });
                
                const issueResult = await issueResponse.json();
                if (issueResult.success) {
                    showCertificateWithVerification(certResult.html, 'Nativity Certificate', issueResult.verification_code, issueResult.message);
                } else {
                    showNotification('‚ùå Error: ' + issueResult.error);
                }
            } catch (error) {
                showNotification('‚ùå Error: ' + error.message);
            }
        }
        
        function getTransferForm() {
            return `
                <div style="background: white; padding: 2rem; border-radius: 10px; border: 2px solid #ea580c;">
                    <h3 style="color: #ea580c; margin-bottom: 1.5rem;">
                        <i class="fas fa-exchange-alt"></i> Transfer Certificate
                    </h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">TC No *</label>
                            <input type="text" id="tc_cert_no" class="form-input" placeholder="TC/2024/12345">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Student Name *</label>
                            <input type="text" id="tc_name" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Father's Name *</label>
                            <input type="text" id="tc_father" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Mother's Name *</label>
                            <input type="text" id="tc_mother" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Date of Birth *</label>
                            <input type="date" id="tc_dob" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Admission Number *</label>
                            <input type="text" id="tc_adm_no" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Admission Date *</label>
                            <input type="date" id="tc_adm_date" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Class at Leaving *</label>
                            <input type="text" id="tc_class" class="form-input" placeholder="Class X">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Leaving Date *</label>
                            <input type="date" id="tc_leave_date" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Reason for Leaving *</label>
                            <input type="text" id="tc_reason" class="form-input" placeholder="Parent Transfer">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Conduct *</label>
                            <select id="tc_conduct" class="form-input">
                                <option value="GOOD">GOOD</option>
                                <option value="VERY GOOD">VERY GOOD</option>
                                <option value="EXCELLENT">EXCELLENT</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Medium *</label>
                            <select id="tc_medium" class="form-input">
                                <option value="ENGLISH">English</option>
                                <option value="TAMIL">Tamil</option>
                            </select>
                        </div>
                        <div class="form-group" style="grid-column: span 2;">
                            <label class="form-label">School Name *</label>
                            <input type="text" id="tc_school" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">School Address *</label>
                            <input type="text" id="tc_school_addr" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">School Code *</label>
                            <input type="text" id="tc_school_code" class="form-input">
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 2rem;">
                        <button class="btn btn-success" onclick="generateTransferCertificate()">
                            <i class="fas fa-certificate"></i> Issue Credential - Transfer Certificate
                        </button>
                    </div>
                </div>
            `;
        }
        
        async function generateTransferCertificate() {
            const data = {
                certificate_no: document.getElementById('tc_cert_no').value,
                student_name: document.getElementById('tc_name').value,
                father_name: document.getElementById('tc_father').value,
                mother_name: document.getElementById('tc_mother').value,
                dob: document.getElementById('tc_dob').value,
                admission_no: document.getElementById('tc_adm_no').value,
                admission_date: document.getElementById('tc_adm_date').value,
                class_leaving: document.getElementById('tc_class').value,
                leaving_date: document.getElementById('tc_leave_date').value,
                reason: document.getElementById('tc_reason').value,
                conduct: document.getElementById('tc_conduct').value,
                medium: document.getElementById('tc_medium').value,
                school_name: document.getElementById('tc_school').value,
                school_address: document.getElementById('tc_school_addr').value,
                school_code: document.getElementById('tc_school_code').value,
                issue_date: new Date().toLocaleDateString('en-GB'),
                remarks: 'The student has completed the academic year successfully.'
            };
            
            try {
                const certResponse = await fetch('/api/generate-transfer-certificate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const certResult = await certResponse.json();
                if (!certResult.success) {
                    showNotification('‚ùå Error: ' + certResult.error);
                    return;
                }
                
                const credentialData = {
                    studentName: data.student_name,
                    studentId: data.admission_no,
                    institutionName: data.school_name,
                    institutionId: data.school_code,
                    degreeType: 'Transfer Certificate',
                    fieldOfStudy: data.class_leaving,
                    graduationDate: data.leaving_date,
                    grade: 'Conduct: ' + data.conduct,
                    certificateType: 'TRANSFER',
                    certificateData: data
                };
                
                const issueResponse = await fetch('/api/issue-credential', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(credentialData)
                });
                
                const issueResult = await issueResponse.json();
                if (issueResult.success) {
                    showCertificateWithVerification(certResult.html, 'Transfer Certificate', issueResult.verification_code, issueResult.message);
                } else {
                    showNotification('‚ùå Error: ' + issueResult.error);
                }
            } catch (error) {
                showNotification('‚ùå Error: ' + error.message);
            }
        }
        
        function getFirstGraduateForm() {
            return `
                <div style="background: white; padding: 2rem; border-radius: 10px; border: 2px solid #0891b2;">
                    <h3 style="color: #0891b2; margin-bottom: 1.5rem;">
                        <i class="fas fa-user-graduate"></i> First Graduate Certificate
                    </h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Certificate No *</label>
                            <input type="text" id="fg_cert_no" class="form-input" placeholder="FG/2024/12345">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Applicant Name *</label>
                            <input type="text" id="fg_name" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Parent/Guardian Name *</label>
                            <input type="text" id="fg_parent" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Date of Birth *</label>
                            <input type="date" id="fg_dob" class="form-input">
                        </div>
                        <div class="form-group" style="grid-column: span 2;">
                            <label class="form-label">Address *</label>
                            <input type="text" id="fg_address" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Degree Obtained *</label>
                            <input type="text" id="fg_degree" class="form-input" placeholder="Bachelor of Technology">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Institution *</label>
                            <input type="text" id="fg_institution" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Year of Passing *</label>
                            <input type="text" id="fg_year" class="form-input" placeholder="2024">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Purpose *</label>
                            <input type="text" id="fg_purpose" class="form-input" placeholder="Scholarship">
                        </div>
                    </div>
                    
                    <h4 style="margin: 1.5rem 0 1rem 0;">Family Education Details</h4>
                    <div style="display: grid; grid-template-columns: 2fr 1fr 2fr auto; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <input type="text" class="form-input" placeholder="Family Member Name" id="fg_mem1_name">
                        <input type="text" class="form-input" placeholder="Relation" id="fg_mem1_rel">
                        <input type="text" class="form-input" placeholder="Education" id="fg_mem1_edu">
                        <button class="btn btn-sm btn-secondary">+</button>
                    </div>
                    
                    <div style="text-align: center; margin-top: 2rem;">
                        <button class="btn btn-success" onclick="generateFirstGraduateCertificate()">
                            <i class="fas fa-certificate"></i> Issue Credential - First Graduate Certificate
                        </button>
                    </div>
                </div>
            `;
        }
        
        async function generateFirstGraduateCertificate() {
            const familyMembers = [
                {
                    name: document.getElementById('fg_mem1_name').value,
                    relationship: document.getElementById('fg_mem1_rel').value,
                    education: document.getElementById('fg_mem1_edu').value
                }
            ];
            
            const data = {
                certificate_no: document.getElementById('fg_cert_no').value,
                applicant_name: document.getElementById('fg_name').value,
                parent_name: document.getElementById('fg_parent').value,
                dob: document.getElementById('fg_dob').value,
                address: document.getElementById('fg_address').value,
                degree: document.getElementById('fg_degree').value,
                institution: document.getElementById('fg_institution').value,
                year_of_passing: document.getElementById('fg_year').value,
                purpose: document.getElementById('fg_purpose').value,
                family_members: familyMembers,
                issue_date: new Date().toLocaleDateString('en-GB')
            };
            
            try {
                const certResponse = await fetch('/api/generate-firstgraduate-certificate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const certResult = await certResponse.json();
                if (!certResult.success) {
                    showNotification('‚ùå Error: ' + certResult.error);
                    return;
                }
                
                const credentialData = {
                    studentName: data.applicant_name,
                    studentId: data.certificate_no,
                    institutionName: data.institution,
                    institutionId: 'HIGHER-EDU',
                    degreeType: 'First Graduate Certificate',
                    fieldOfStudy: data.degree,
                    graduationDate: data.year_of_passing,
                    grade: 'First Graduate',
                    certificateType: 'FIRST_GRADUATE',
                    certificateData: data
                };
                
                const issueResponse = await fetch('/api/issue-credential', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(credentialData)
                });
                
                const issueResult = await issueResponse.json();
                if (issueResult.success) {
                    showCertificateWithVerification(certResult.html, 'First Graduate Certificate', issueResult.verification_code, issueResult.message);
                } else {
                    showNotification('‚ùå Error: ' + issueResult.error);
                }
            } catch (error) {
                showNotification('‚ùå Error: ' + error.message);
            }
        }
        
        // Blockchain Explorer Functions
        async function loadBlockchainExplorer() {
            try {
                const response = await fetch('/api/blockchain-explorer');
                const data = await response.json();
                
                if (data.success) {
                    // Update blockchain stats
                    const stats = data.blockchain_stats;
                    document.getElementById('totalBlocks').textContent = stats.total_blocks;
                    document.getElementById('totalTransactions').textContent = stats.total_transactions;
                    document.getElementById('chainDifficulty').textContent = stats.chain_difficulty;
                    document.getElementById('chainValid').textContent = stats.chain_valid ? '‚úÖ Valid' : '‚ùå Invalid';
                    
                    // Display recent blocks
                    displayRecentBlocks(data.recent_blocks);
                }
            } catch (error) {
                console.error('Error loading blockchain explorer:', error);
                document.getElementById('blockchainBlocks').innerHTML = 
                    '<p style="color: #dc3545;">Error loading blockchain data</p>';
            }
        }
        
        function displayRecentBlocks(blocks) {
            const container = document.getElementById('blockchainBlocks');
            
            if (!blocks || blocks.length === 0) {
                container.innerHTML = '<p style="color: #666;">No blocks found</p>';
                return;
            }
            
            let html = '';
            blocks.forEach(block => {
                const transactionCount = block.data.transactions ? block.data.transactions.length : 0;
                
                html += `
                    <div style="background: white; border-radius: 10px; padding: 1.5rem; margin-bottom: 1rem; border-left: 4px solid #667eea;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                            <div>
                                <strong>Block #${block.index}</strong><br>
                                <small style="color: #666;">${block.human_time}</small>
                            </div>
                            <div>
                                <strong>Hash:</strong><br>
                                <code style="font-size: 0.8em; color: #667eea;">${block.hash.substring(0, 16)}...</code>
                            </div>
                            <div>
                                <strong>Transactions:</strong><br>
                                <span style="color: #28a745;">üìù ${transactionCount}</span>
                            </div>
                        </div>
                        
                        ${transactionCount > 0 ? `
                            <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px;">
                                <strong>Recent Transactions:</strong>
                                ${block.data.transactions.slice(0, 3).map(tx => `
                                    <div style="margin: 0.5rem 0; padding: 0.5rem; background: white; border-radius: 5px;">
                                        <span style="color: #667eea;">üîó ${tx.type}</span>
                                        ${tx.credential_id ? `- ID: ${tx.credential_id.substring(0, 8)}...` : ''}
                                        ${tx.student_id ? `- Student: ${tx.student_id}` : ''}
                                    </div>
                                `).join('')}
                                ${transactionCount > 3 ? `<small style="color: #666;">... and ${transactionCount - 3} more transactions</small>` : ''}
                            </div>
                        ` : ''}
                        
                        <div style="margin-top: 1rem; font-size: 0.9em; color: #666;">
                            <strong>Previous Hash:</strong> <code>${block.previous_hash.substring(0, 16)}...</code> |
                            <strong>Nonce:</strong> ${block.nonce}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        async function mineNewBlock() {
            const resultDiv = document.getElementById('miningResult');
            const button = event.target;
            
            // Show mining in progress
            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Mining...';
            resultDiv.innerHTML = '<p style="color: #ffc107;">‚õèÔ∏è Mining new block... This may take a moment.</p>';
            
            try {
                const response = await fetch('/api/mine-block', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    resultDiv.innerHTML = `
                        <div style="background: #d4edda; color: #155724; padding: 1rem; border-radius: 8px;">
                            <strong>‚úÖ Block Mined Successfully!</strong><br>
                            Block #${result.block.index} | Hash: ${result.block.hash.substring(0, 16)}...<br>
                            Nonce: ${result.block.nonce} | Transactions: ${result.block.data.transactions ? result.block.data.transactions.length : 0}
                        </div>
                    `;
                    
                    // Refresh blockchain explorer
                    setTimeout(() => {
                        loadBlockchainExplorer();
                    }, 1000);
                    
                    showNotification('‚úÖ New block mined and added to blockchain!');
                } else {
                    resultDiv.innerHTML = `
                        <div style="background: #fff3cd; color: #856404; padding: 1rem; border-radius: 8px;">
                            <strong>‚ÑπÔ∏è ${result.message}</strong>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div style="background: #f8d7da; color: #721c24; padding: 1rem; border-radius: 8px;">
                        <strong>‚ùå Mining Error:</strong> ${error.message}
                    </div>
                `;
            } finally {
                // Reset button
                button.disabled = false;
                button.innerHTML = '<i class="fas fa-hammer"></i> Mine Block';
            }
        }

        async function addCustomTransaction() {
            const transactionType = prompt('Enter transaction type (e.g., CUSTOM_TRANSACTION, DEMO_TX):') || 'CUSTOM_TRANSACTION';
            const description = prompt('Enter transaction description:') || 'Custom blockchain transaction';
            const value = prompt('Enter transaction value/data:') || 'Demo Value';
            
            if (!transactionType || !description) {
                showNotification('‚ùå Transaction creation cancelled');
                return;
            }
            
            try {
                const response = await fetch('/api/add-transaction', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        type: transactionType,
                        description: description,
                        data: { value: value, timestamp: new Date().toISOString() },
                        sender: 'USER_INTERFACE'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification(`‚úÖ Transaction added! ID: ${result.transaction_id}`);
                    document.getElementById('pendingCount').textContent = result.pending_count;
                    
                    // Update mining result
                    document.getElementById('miningResult').innerHTML = `
                        <div style="background: #d1ecf1; color: #0c5460; padding: 1rem; border-radius: 8px;">
                            <strong>üìù Transaction Added:</strong> ${result.transaction_id}<br>
                            <small>Pending transactions: ${result.pending_count}</small>
                        </div>
                    `;
                } else {
                    showNotification('‚ùå Failed to add transaction: ' + result.error);
                }
            } catch (error) {
                showNotification('‚ùå Error adding transaction: ' + error.message);
            }
        }

        async function viewPendingTransactions() {
            try {
                const response = await fetch('/api/pending-transactions');
                const result = await response.json();
                
                if (result.success) {
                    const resultDiv = document.getElementById('miningResult');
                    
                    if (result.count === 0) {
                        resultDiv.innerHTML = `
                            <div style="background: #fff3cd; color: #856404; padding: 1rem; border-radius: 8px;">
                                <strong>üì≠ No Pending Transactions</strong><br>
                                <small>Add some transactions to mine them into blocks</small>
                            </div>
                        `;
                    } else {
                        let transactionsHtml = `
                            <div style="background: #e8f4fd; color: #0c5460; padding: 1rem; border-radius: 8px;">
                                <strong>üìã Pending Transactions (${result.count}):</strong><br>
                        `;
                        
                        result.pending_transactions.forEach((tx, index) => {
                            transactionsHtml += `
                                <div style="margin: 0.5rem 0; padding: 0.5rem; background: rgba(255,255,255,0.5); border-radius: 4px;">
                                    <strong>${index + 1}.</strong> ${tx.type} - ${tx.description || 'No description'}<br>
                                    <small>ID: ${tx.transaction_id || 'Pending'}</small>
                                </div>
                            `;
                        });
                        
                        transactionsHtml += '</div>';
                        resultDiv.innerHTML = transactionsHtml;
                    }
                    
                    document.getElementById('pendingCount').textContent = result.count;
                } else {
                    showNotification('‚ùå Failed to load pending transactions');
                }
            } catch (error) {
                showNotification('‚ùå Error loading pending transactions: ' + error.message);
            }
        }

        async function refreshBlockchain() {
            showNotification('üîÑ Refreshing blockchain data...');
            await loadBlockchainExplorer();
            await viewPendingTransactions();
            showNotification('‚úÖ Blockchain data refreshed');
        }

        // Certificate Generation Functions
        async function generateCertificate(verificationCode) {
            try {
                const response = await fetch(`/api/generate-certificate/${verificationCode}`);
                const result = await response.json();
                
                if (result.success) {
                    // Show QR code in modal or new section
                    const qrModal = document.createElement('div');
                    qrModal.style.cssText = `
                        position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                        background: rgba(0,0,0,0.8); z-index: 1000; display: flex; 
                        align-items: center; justify-content: center;
                    `;
                    
                    qrModal.innerHTML = `
                        <div style="background: white; padding: 2rem; border-radius: 15px; text-align: center; max-width: 400px;">
                            <h3 style="margin-bottom: 1rem;">üéì Certificate QR Code</h3>
                            <img src="data:image/png;base64,${result.qr_code}" style="width: 200px; height: 200px; margin: 1rem 0;">
                            <p><strong>Verification Code:</strong> ${verificationCode}</p>
                            <p style="font-size: 0.9em; color: #666;">Scan to verify certificate</p>
                            <button onclick="this.parentElement.parentElement.remove()" 
                                    style="background: #dc3545; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">
                                Close
                            </button>
                        </div>
                    `;
                    
                    document.body.appendChild(qrModal);
                    showNotification('‚úÖ QR Certificate generated successfully!');
                } else {
                    showNotification('‚ùå Error generating certificate: ' + result.error);
                }
            } catch (error) {
                showNotification('‚ùå Error: ' + error.message);
            }
        }
        
        function downloadCertificate(verificationCode) {
            // Create download link
            const downloadUrl = `/api/download-certificate/${verificationCode}`;
            const link = document.createElement('a');
            link.href = downloadUrl;
            link.download = `certificate_${verificationCode}.pdf`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('üìÑ Certificate PDF download started!');
        }
        
        function viewCertificate(verificationCode) {
            // Open certificate in new tab
            const certificateUrl = `/certificate/${verificationCode}`;
            window.open(certificateUrl, '_blank');
            
            showNotification('üëÅÔ∏è Certificate opened in new tab!');
        }
        
        // Dashboard refresh function
        async function refreshDashboard() {
            const refreshBtn = event.target;
            const originalText = refreshBtn.innerHTML;
            
            // Show loading state
            refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Refreshing...';
            refreshBtn.disabled = true;
            
            try {
                await loadDashboardData();
                showNotification('‚úÖ Dashboard refreshed successfully!');
            } catch (error) {
                showNotification('‚ùå Error refreshing dashboard');
                console.error('Refresh error:', error);
            } finally {
                // Reset button
                refreshBtn.innerHTML = originalText;
                refreshBtn.disabled = false;
            }
        }
        
        async function emailCertificate(verificationCode) {
            // Prompt for email address
            const email = prompt('Enter email address to send certificate:', 'student@example.com');
            
            if (!email) {
                showNotification('‚ùå Email sending cancelled');
                return;
            }
            
            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showNotification('‚ùå Please enter a valid email address');
                return;
            }
            
            try {
                showNotification('üìß Sending certificate email...');
                
                const response = await fetch(`/api/send-certificate-email/${verificationCode}?email=${encodeURIComponent(email)}`);
                const result = await response.json();
                
                if (result.success) {
                    showNotification(`‚úÖ Certificate emailed successfully to ${email}!`);
                    
                    // Show email confirmation modal
                    const emailModal = document.createElement('div');
                    emailModal.style.cssText = `
                        position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                        background: rgba(0,0,0,0.8); z-index: 1000; display: flex; 
                        align-items: center; justify-content: center;
                    `;
                    
                    emailModal.innerHTML = `
                        <div style="background: white; padding: 2rem; border-radius: 15px; text-align: center; max-width: 500px;">
                            <h3 style="margin-bottom: 1rem; color: #28a745;">üìß Email Sent Successfully!</h3>
                            <p><strong>Certificate sent to:</strong> ${email}</p>
                            <p><strong>Verification Code:</strong> ${verificationCode}</p>
                            <p style="font-size: 0.9em; color: #666; margin-top: 1rem;">
                                The recipient will receive a professional certificate PDF with QR code verification.
                            </p>
                            <button onclick="this.parentElement.parentElement.remove()" 
                                    style="background: #28a745; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; margin-top: 1rem;">
                                Close
                            </button>
                        </div>
                    `;
                    
                    document.body.appendChild(emailModal);
                } else {
                    showNotification(`‚ùå Email sending failed: ${result.error}`);
                }
            } catch (error) {
                showNotification('‚ùå Error sending email: ' + error.message);
            }
        }

        // Enhanced dashboard initialization
        async function loadDashboardData() {
            try {
                // Try to load real analytics first
                const response = await fetch('/api/analytics/dashboard');
                const data = await response.json();
                
                if (data.success) {
                    updateDashboardDisplay(data.analytics);
                } else {
                    // Fallback to sample data for demonstration
                    initializeDashboardWithSampleData();
                }
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                // Use sample data if API fails
                initializeDashboardWithSampleData();
            }
        }

        // Advanced Features Functions
        async function loadAdvancedFeatures() {
            try {
                const response = await fetch('/api/system-status/advanced');
                const data = await response.json();
                
                if (data.success) {
                    const features = data.system_status.advanced_features;
                    
                    // Update feature status indicators
                    updateFeatureStatus('ocrStatus', features.ocr_forensics?.status);
                    updateFeatureStatus('pkiStatus', features.digital_signing?.status);
                    updateFeatureStatus('dualStatus', features.dual_strategy?.status);
                    updateFeatureStatus('mlStatus', features.ml_forensics?.status);
                    
                    // Update system status
                    updateAdvancedSystemStatus(data.system_status);
                    
                    // Update ML statistics
                    updateMLStatistics(features.ml_forensics?.statistics);
                }
            } catch (error) {
                console.error('Error loading advanced features:', error);
            }
        }
        
        function updateFeatureStatus(elementId, status) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = status || 'UNKNOWN';
                element.className = 'feature-status ' + 
                    (status === 'OPERATIONAL' ? 'status-operational' : 'status-error');
            }
        }
        
        function updateAdvancedSystemStatus(systemStatus) {
            const statusDiv = document.getElementById('advancedSystemStatus');
            if (statusDiv && systemStatus) {
                statusDiv.innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div style="background: white; padding: 1rem; border-radius: 10px;">
                            <strong style="color: #333;">Core System</strong><br>
                            <span style="color: ${systemStatus.core_system?.blockchain_status === 'OPERATIONAL' ? '#28a745' : '#dc3545'};">
                                Blockchain: ${systemStatus.core_system?.blockchain_status || 'UNKNOWN'}
                            </span>
                        </div>
                        <div style="background: white; padding: 1rem; border-radius: 10px;">
                            <strong style="color: #333;">Performance</strong><br>
                            <span style="color: #007bff;">
                                Response: ${(systemStatus.performance?.response_time * 1000).toFixed(0)}ms
                            </span>
                        </div>
                        <div style="background: white; padding: 1rem; border-radius: 10px;">
                            <strong style="color: #333;">Features</strong><br>
                            <span style="color: #28a745;">
                                ${Object.keys(systemStatus.advanced_features || {}).length} Active
                            </span>
                        </div>
                    </div>
                `;
            }
        }
        
        function updateMLStatistics(mlStats) {
            if (mlStats) {
                const trainingSize = document.getElementById('trainingDataSize');
                const accuracy = document.getElementById('modelAccuracy');
                
                if (trainingSize) {
                    trainingSize.textContent = mlStats.training_data_size || '0';
                }
                
                if (accuracy) {
                    // Simulate accuracy based on training data size
                    const simulatedAccuracy = Math.min(85 + (mlStats.training_data_size || 0) * 0.1, 98);
                    accuracy.textContent = simulatedAccuracy.toFixed(1) + '%';
                }
            }
        }
        
        function previewAdvancedImage() {
            const fileInput = document.getElementById('advancedImageUpload');
            const preview = document.getElementById('advancedImagePreview');
            const previewImg = document.getElementById('previewImg');
            const analyzeBtn = document.getElementById('analyzeBtn');
            
            if (fileInput.files && fileInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImg.src = e.target.result;
                    preview.style.display = 'block';
                    analyzeBtn.disabled = false;
                };
                reader.readAsDataURL(fileInput.files[0]);
            }
        }
        
        async function performAdvancedAnalysis() {
            const fileInput = document.getElementById('advancedImageUpload');
            const resultDiv = document.getElementById('advancedAnalysisResult');
            
            if (!fileInput.files || !fileInput.files[0]) {
                showNotification('‚ùå Please select an image file first');
                return;
            }
            
            resultDiv.innerHTML = '<div style="text-align: center; color: #007bff;"><i class="fas fa-spinner fa-spin"></i> Analyzing certificate...</div>';
            
            try {
                const formData = new FormData();
                formData.append('certificate_image', fileInput.files[0]);
                
                const response = await fetch('/api/advanced-verification', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayAdvancedAnalysisResult(data.processing_result);
                } else {
                    resultDiv.innerHTML = `<div style="color: #dc3545;">‚ùå Analysis failed: ${data.error}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div style="color: #dc3545;">‚ùå Error: ${error.message}</div>`;
            }
        }
        
        function displayAdvancedAnalysisResult(result) {
            const resultDiv = document.getElementById('advancedAnalysisResult');
            
            const confidence = result.overall_confidence || 0;
            const status = result.verification_status || 'UNKNOWN';
            const certType = result.certificate_type || 'unknown';
            
            const confidenceColor = confidence > 80 ? '#28a745' : confidence > 50 ? '#ffc107' : '#dc3545';
            
            resultDiv.innerHTML = `
                <div style="background: white; padding: 1.5rem; border-radius: 10px; border-left: 4px solid ${confidenceColor};">
                    <h4 style="color: #333; margin-bottom: 1rem;">üìä Analysis Results</h4>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <strong style="color: #666;">Confidence:</strong><br>
                            <span style="color: ${confidenceColor}; font-size: 1.2rem; font-weight: 600;">${confidence}%</span>
                        </div>
                        <div>
                            <strong style="color: #666;">Status:</strong><br>
                            <span style="color: ${confidenceColor};">${status}</span>
                        </div>
                        <div>
                            <strong style="color: #666;">Type:</strong><br>
                            <span style="color: #007bff;">${certType.replace('_', ' ').toUpperCase()}</span>
                        </div>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px;">
                        <strong style="color: #333;">Recommendation:</strong><br>
                        <span style="color: #666;">${result.recommendation || 'Analysis completed successfully'}</span>
                    </div>
                    
                    ${result.ml_forensics ? `
                        <div style="margin-top: 1rem; background: #e8f4fd; padding: 1rem; border-radius: 8px;">
                            <strong style="color: #333;">ü§ñ ML Forensics:</strong><br>
                            <span style="color: #666;">
                                Authenticity: ${result.ml_forensics.authenticity_class || 'Unknown'} 
                                (${(result.ml_forensics.confidence || 0)}% confidence)
                            </span>
                        </div>
                    ` : ''}
                </div>
            `;
        }
        
        async function refreshAdvancedStatus() {
            await loadAdvancedFeatures();
            showNotification('‚úÖ Advanced system status refreshed');
        }
        
        async function simulateMLTraining() {
            const resultDiv = document.getElementById('mlTrainingResult');
            resultDiv.innerHTML = '<div style="color: #007bff;"><i class="fas fa-spinner fa-spin"></i> Training ML models...</div>';
            
            // Simulate training process
            setTimeout(() => {
                const newAccuracy = (Math.random() * 5 + 90).toFixed(1);
                resultDiv.innerHTML = `
                    <div style="background: #d4edda; color: #155724; padding: 1rem; border-radius: 8px;">
                        ‚úÖ ML training completed!<br>
                        New model accuracy: ${newAccuracy}%<br>
                        Training samples processed: ${Math.floor(Math.random() * 100 + 50)}
                    </div>
                `;
                
                // Update the accuracy display
                const accuracyDiv = document.getElementById('modelAccuracy');
                if (accuracyDiv) {
                    accuracyDiv.textContent = newAccuracy + '%';
                }
            }, 3000);
        }

        // DigiLocker Functions
        async function loadDigiLockerStatus() {
            try {
                const response = await fetch('/api/digilocker/status');
                const data = await response.json();
                
                const authStatusDiv = document.getElementById('authStatusContent');
                if (data.success && data.authenticated) {
                    const userInfo = data.user_info;
                    authStatusDiv.innerHTML = `
                        <div style="background: #d4edda; color: #155724; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            ‚úÖ <strong>Authenticated</strong>
                            <div style="margin-top: 0.5rem;">
                                üë§ <strong>Name:</strong> ${userInfo.name || 'Unknown'}<br>
                                üìß <strong>Email:</strong> ${userInfo.email || 'Not provided'}<br>
                                üì± <strong>Mobile:</strong> ${userInfo.mobile || 'Not provided'}<br>
                                üÜî <strong>DigiLocker ID:</strong> ${userInfo.digilocker_id || userInfo.user_id}
                            </div>
                        </div>
                        <button class="btn btn-danger" onclick="logoutFromDigiLocker()">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    `;
                    
                    // Update header auth status
                    updateHeaderAuthStatus(userInfo);
                    
                    // Update statistics
                    if (data.integration_statistics) {
                        updateNADStatistics(data.integration_statistics);
                    }
                } else {
                    authStatusDiv.innerHTML = `
                        <div style="background: #f8d7da; color: #721c24; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            ‚ùå <strong>Not Authenticated</strong>
                            <p style="margin-top: 0.5rem;">Please login to access DigiLocker documents and NAD verification.</p>
                        </div>
                        <button class="btn btn-primary" onclick="redirectToLogin()">
                            <i class="fas fa-sign-in-alt"></i> Login with DigiLocker
                        </button>
                    `;
                }
            } catch (error) {
                console.error('Error loading DigiLocker status:', error);
                document.getElementById('authStatusContent').innerHTML = `
                    <div style="background: #f8d7da; color: #721c24; padding: 1rem; border-radius: 8px;">
                        ‚ùå Error loading authentication status
                    </div>
                `;
            }
        }

        function updateHeaderAuthStatus(userInfo) {
            const authStatusDiv = document.getElementById('authStatus');
            if (userInfo) {
                authStatusDiv.innerHTML = `
                    <div class="user-info">
                        <i class="fas fa-user-check"></i>
                        <span>${userInfo.name || 'User'}</span>
                    </div>
                    <button class="logout-btn" onclick="logoutFromDigiLocker()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                `;
            } else {
                authStatusDiv.innerHTML = `
                    <button class="btn btn-primary" onclick="redirectToLogin()">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                `;
            }
        }

        function updateNADStatistics(stats) {
            document.getElementById('verifiedInstitutions').textContent = stats.total_users || 0;
            document.getElementById('verifiedDocuments').textContent = stats.nad_cache_entries || 0;
            document.getElementById('activeUsers').textContent = stats.active_sessions || 0;
        }

        async function loadDigiLockerDocuments() {
            const documentsDiv = document.getElementById('digilockerDocuments');
            documentsDiv.innerHTML = '<div style="color: #007bff;"><i class="fas fa-spinner fa-spin"></i> Loading documents...</div>';
            
            try {
                const response = await fetch('/api/digilocker/documents');
                const data = await response.json();
                
                if (data.success) {
                    if (data.documents && data.documents.length > 0) {
                        let documentsHtml = '';
                        
                        // Show demo mode notification if applicable
                        if (data.demo_mode) {
                            documentsHtml += `
                                <div style="background: #fff3cd; color: #856404; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border-left: 4px solid #ffc107;">
                                    <strong>üìã Demo Mode:</strong> ${data.message}
                                    <br><small>Login with DigiLocker for access to your real documents.</small>
                                </div>
                            `;
                        } else if (data.authenticated) {
                            documentsHtml += `
                                <div style="background: #d1ecf1; color: #0c5460; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border-left: 4px solid #17a2b8;">
                                    <strong>üîê Authenticated:</strong> ${data.message}
                                </div>
                            `;
                        }
                        
                        documentsHtml += '<div style="display: grid; gap: 1rem;">';
                        
                        data.documents.forEach(doc => {
                            const statusColor = doc.verification_status === 'DIGILOCKER_VERIFIED' ? '#28a745' : '#ffc107';
                            const isDemoDoc = doc.document_id.startsWith('DEMO_');
                            
                            documentsHtml += `
                                <div style="background: white; padding: 1.5rem; border-radius: 10px; border-left: 4px solid ${statusColor}; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div style="flex: 1;">
                                            <h4 style="color: #333; margin-bottom: 0.5rem;">
                                                ${doc.name}
                                                ${isDemoDoc ? '<span style="background: #ffc107; color: #856404; padding: 0.2rem 0.5rem; border-radius: 10px; font-size: 0.7rem; margin-left: 0.5rem;">DEMO</span>' : ''}
                                            </h4>
                                            <p style="color: #666; margin-bottom: 0.5rem;"><strong>Student:</strong> ${doc.student_name}</p>
                                            <p style="color: #666; margin-bottom: 0.5rem;"><strong>Issuer:</strong> ${doc.issuer}</p>
                                            <p style="color: #666; margin-bottom: 0.5rem;"><strong>Field:</strong> ${doc.field_of_study}</p>
                                            <p style="color: #666; margin-bottom: 0.5rem;"><strong>Issue Date:</strong> ${doc.issue_date || 'Not specified'}</p>
                                        </div>
                                        <div style="text-align: right;">
                                            <div style="background: ${statusColor}; color: white; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.8rem; margin-bottom: 0.5rem;">
                                                ${doc.verification_status}
                                            </div>
                                            <button class="btn btn-sm btn-primary" onclick="verifyDocument('${doc.document_id}')" style="margin-bottom: 0.5rem;">
                                                <i class="fas fa-check"></i> Verify
                                            </button>
                                            <br>
                                            <button class="btn btn-sm btn-outline-secondary" onclick="downloadDocument('${doc.document_id}')">
                                                <i class="fas fa-download"></i> Download
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                        
                        documentsHtml += '</div>';
                        documentsDiv.innerHTML = documentsHtml;
                    } else {
                        documentsDiv.innerHTML = `
                            <div style="text-align: center; color: #666; padding: 2rem;">
                                <i class="fas fa-folder-open" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                                <p>No academic documents found in your DigiLocker</p>
                                <small>Login with DigiLocker to access your verified documents</small>
                            </div>
                        `;
                    }
                } else {
                    documentsDiv.innerHTML = `
                        <div style="background: #f8d7da; color: #721c24; padding: 1rem; border-radius: 8px; border-left: 4px solid #dc3545;">
                            ‚ùå <strong>Error:</strong> ${data.error}
                            <br><small>Please try refreshing or login with DigiLocker</small>
                        </div>
                    `;
                }
            } catch (error) {
                documentsDiv.innerHTML = `
                    <div style="background: #f8d7da; color: #721c24; padding: 1rem; border-radius: 8px; border-left: 4px solid #dc3545;">
                        ‚ùå <strong>Connection Error:</strong> ${error.message}
                        <br><small>Please check your internet connection and try again</small>
                    </div>
                `;
            }
        }

        function downloadDocument(documentId) {
            showNotification(`üìÑ Downloading document: ${documentId}`);
            // In a real implementation, this would download the actual document
            setTimeout(() => {
                showNotification('‚úÖ Document download completed (simulated)');
            }, 1500);
        }

        async function verifyWithDigiLocker() {
            const documentURI = document.getElementById('documentURI').value.trim();
            const resultDiv = document.getElementById('digilockerVerificationResult');
            
            if (!documentURI) {
                showNotification('‚ùå Please enter a document URI');
                return;
            }
            
            resultDiv.innerHTML = '<div style="color: #007bff;"><i class="fas fa-spinner fa-spin"></i> Verifying with DigiLocker & NAD...</div>';
            
            try {
                const response = await fetch('/api/digilocker/verify-document', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        document_info: {
                            document_id: documentURI,
                            source: 'MANUAL_INPUT'
                        }
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayDigiLockerVerificationResult(data.verification_result);
                } else {
                    resultDiv.innerHTML = `<div style="color: #dc3545;">‚ùå Verification failed: ${data.error}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div style="color: #dc3545;">‚ùå Error: ${error.message}</div>`;
            }
        }

        function displayDigiLockerVerificationResult(result) {
            const resultDiv = document.getElementById('digilockerVerificationResult');
            const confidence = result.overall_confidence || 0;
            const confidenceColor = confidence > 80 ? '#28a745' : confidence > 50 ? '#ffc107' : '#dc3545';
            
            resultDiv.innerHTML = `
                <div style="background: white; padding: 2rem; border-radius: 10px; border-left: 4px solid ${confidenceColor};">
                    <h4 style="color: #333; margin-bottom: 1rem;">üîç DigiLocker & NAD Verification Results</h4>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                        <div>
                            <strong style="color: #666;">Overall Confidence:</strong><br>
                            <span style="color: ${confidenceColor}; font-size: 1.3rem; font-weight: 600;">${confidence}%</span>
                        </div>
                        <div>
                            <strong style="color: #666;">DigiLocker Status:</strong><br>
                            <span style="color: ${result.verification_sources?.digilocker?.verified ? '#28a745' : '#dc3545'};">
                                ${result.verification_sources?.digilocker?.verified ? '‚úÖ Verified' : '‚ùå Not Verified'}
                            </span>
                        </div>
                        <div>
                            <strong style="color: #666;">NAD Status:</strong><br>
                            <span style="color: ${result.verification_sources?.nad?.nad_verified ? '#28a745' : '#dc3545'};">
                                ${result.verification_sources?.nad?.nad_verified ? '‚úÖ Verified' : '‚ùå Not Verified'}
                            </span>
                        </div>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem;">
                        <strong style="color: #333;">Recommendation:</strong><br>
                        <span style="color: #666;">${result.recommendation}</span>
                    </div>
                    
                    ${result.verification_sources?.nad ? `
                        <div style="background: #e8f4fd; padding: 1.5rem; border-radius: 8px;">
                            <strong style="color: #333;">üìä NAD Verification Details:</strong><br>
                            <div style="margin-top: 0.5rem;">
                                <span style="color: #666;">
                                    Score: ${result.verification_sources.nad.verification_score || 0}% | 
                                    Institution Verified: ${result.verification_sources.nad.verification_details?.institution_verified ? 'Yes' : 'No'} | 
                                    Digital Signature: ${result.verification_sources.nad.verification_details?.digital_signature_valid ? 'Valid' : 'Invalid'}
                                </span>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        async function logoutFromDigiLocker() {
            try {
                const response = await fetch('/api/digilocker/logout', {
                    method: 'POST'
                });
                
                const data = await response.json();
                if (data.success) {
                    showNotification('‚úÖ Logged out successfully');
                    loadDigiLockerStatus(); // Refresh status
                } else {
                    showNotification('‚ùå Logout failed: ' + data.error);
                }
            } catch (error) {
                showNotification('‚ùå Error during logout: ' + error.message);
            }
        }

        function redirectToLogin() {
            window.location.href = '/login';
        }

        async function refreshDocuments() {
            await loadDigiLockerDocuments();
            showNotification('‚úÖ Documents refreshed');
        }

        async function pullFromNAD() {
            const resultDiv = document.getElementById('quickActionResult');
            resultDiv.innerHTML = '<div style="color: #007bff;"><i class="fas fa-spinner fa-spin"></i> Pulling documents from NAD...</div>';
            
            // Simulate NAD pull operation
            setTimeout(() => {
                const newDocs = Math.floor(Math.random() * 5) + 1;
                resultDiv.innerHTML = `
                    <div style="background: #d4edda; color: #155724; padding: 1rem; border-radius: 8px;">
                        ‚úÖ Successfully pulled ${newDocs} new documents from NAD
                    </div>
                `;
            }, 2000);
        }

        async function syncWithDigiLocker() {
            const resultDiv = document.getElementById('quickActionResult');
            resultDiv.innerHTML = '<div style="color: #007bff;"><i class="fas fa-spinner fa-spin"></i> Syncing with DigiLocker...</div>';
            
            // Simulate sync operation
            setTimeout(() => {
                resultDiv.innerHTML = `
                    <div style="background: #d1ecf1; color: #0c5460; padding: 1rem; border-radius: 8px;">
                        ‚úÖ DigiLocker sync completed successfully
                    </div>
                `;
            }, 1500);
        }

        async function exportVerificationReport() {
            const resultDiv = document.getElementById('quickActionResult');
            resultDiv.innerHTML = '<div style="color: #007bff;"><i class="fas fa-spinner fa-spin"></i> Generating verification report...</div>';
            
            // Simulate report generation
            setTimeout(() => {
                resultDiv.innerHTML = `
                    <div style="background: #fff3cd; color: #856404; padding: 1rem; border-radius: 8px;">
                        üìÑ Verification report generated successfully
                        <br><a href="#" style="color: #007bff;">Download Report (PDF)</a>
                    </div>
                `;
            }, 2000);
        }

        async function viewIntegrationLogs() {
            const resultDiv = document.getElementById('quickActionResult');
            resultDiv.innerHTML = `
                <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; font-family: monospace; font-size: 0.9rem;">
                    <strong>Integration Logs:</strong><br>
                    [${new Date().toISOString()}] DigiLocker API: Connection established<br>
                    [${new Date().toISOString()}] NAD Service: Authentication successful<br>
                    [${new Date().toISOString()}] Document sync: 15 documents processed<br>
                    [${new Date().toISOString()}] Verification cache: Updated successfully
                </div>
            `;
        }

        async function verifyDocument(documentId) {
            showNotification('üîç Verifying document: ' + documentId);
            // This would call the verification API
        }

        // Initialize dashboard, institutions, blockchain, advanced features, and DigiLocker on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadDashboardData();
            loadInstitutions();
            loadBlockchainExplorer();
            loadAdvancedFeatures();
            loadDigiLockerStatus();
        });
    </script>
</body>
</html>
